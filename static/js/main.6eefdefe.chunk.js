(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{19:function(e,t,n){},41:function(e,t,n){e.exports=n(97)},45:function(e,t,n){},97:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),o=n(38),a=n.n(o),c=(n(45),n(19),n(9)),s=n(8),u=n.n(s),l=n(17),d=n(11),h=n(12),f=n(14),p=n(13),_=n(15);function m(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}var v=n(39),y=n.n(v),g=n(40),b=(n(27),.2),w=100,E=w,x=function(){var e=Object(l.a)(u.a.mark(function e(t,n){var i,r,o=arguments;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=o.length>2&&void 0!==o[2]?o[2]:0,r=0;case 2:if(!(r<n)){e.next=9;break}return t.map(function(e){return S(e,t)}),e.next=6,Object(g.delay)(i);case 6:r++,e.next=2;break;case 9:return e.abrupt("return",t);case 10:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),k=function(e){for(var t=[],n=0;n<e;n++){var i=re.entity[n%re.entity.length];t.push(Z(i))}return t},O=function(e,t){t.forEach(function(t){t.id===e.id&&(t.chief_age=m(12,45))})},S=function(e,t){if(N(e,t),function(e,t){var n=Math.random()<=e.chief_age/1e3-.3;return n&&K("DEATH","".concat(e.name,"'s Chief has died."),[e.id],t),n}(e,t))!function(e,t){var n=$(e,t),i=m(0,n.length);K("DISMANTLE","".concat(i," communities have decided to leave ").concat(e.name,"."),[e.id],t),n.map(function(e,n){return n<=i-1&&I(e,t),!0})}(e,t),O(e,t);else if(null===e.chief){K("DECISION","The chief polity ".concat(e.name," deliberates"),[e.id],t);var n=M(e,t);n&&W(e,n,t)?B(e,n,null,t):T(e,t)}else{var i=q(e,t);K("DECISION","".concat(i.name,"'s subordinate polity ").concat(e.name," deliberates"),[e.id],t),L(i,e,t)?R(i,e,t):T(e,t)}return e},M=function(e,t){var n=A(e,t).filter(function(e){return!ee(e)}).map(function(e){return q(e,t)}).sort(function(e,n){return J(e,t)-J(n,t)});return n.length>0&&n[0]},j=function(e,t,n){return[e].concat(Object(c.a)(X(e,n))).reduce(function(e,n){return e+(i=t,r=n,E>=Math.hypot(r.coordinates.x-i.coordinates.x,r.coordinates.y-i.coordinates.y));var i,r},0)},A=function(e,t){return t.filter(function(n){return q(n,t).id!==e.id&&n.id!==e.id&&j(e,n,t)})},C=function(e,t){var n=[],i=X(e,t).sort(function(e,n){return J(n,t)-J(e,t)});i.length>4&&i.map(function(t,r){return r>=4?n.push({chief:i[r-4],target:t}):n.push({chief:e,target:t}),!0}),n.map(function(e){return t.forEach(function(t){t.id===e.target.id&&(t.chief=e.chief.id)}),!0})},I=function(e,t){var n=q(e,t);t.forEach(function(i){i.id===e.id?(K("SECESSION","".concat(i.name," is seceded from ").concat(n.name,"."),[i.id,n.id],t),i.chief=null):i.id===n.id&&(i.has_incurred_secession=!0)})},N=function(e,t){t.forEach(function(t){t.id===e.id&&(t.has_incurred_secession=!1,t.has_incurred_war=!1,t.chief_age+=1)})},W=function(e,t,n){var i=G(e,t,n),r=P(i);return Math.random()<=F(e,i,r)},L=function(e,t,n){var i=1-G(e,t,n);return Math.random()<=i},R=function(e,t,n){K("REBELLION","".concat(t.name," attempts rebellion against ").concat(e.name,"."),[t.id],n);var i=G(e,t,n);D(1-i)?(K("REBELLION","".concat(t.name," succeeds in rebellion against ").concat(e.name,"."),[t.id],n),U(H(i),[e.id,t.id],n),I(t,n),C(q(e),n)):(K("REBELLION","".concat(t.name," fails in rebellion against ").concat(e.name,"."),[t.id],n),U(P(i),[e.id,t.id],n))},T=function(e,t){K("PEACE","".concat(e.name," has peace."),[e.id],t),z(Math.sign(e.baseline_resource_level-e.resource_level)*(e.baseline_resource_level/3),[e.id],t)},B=function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0,o=function(e,t,n){var i=[];return(i=X(t,n).length>0?A(e,n).filter(function(e){return q(e,n).id===t.id}).sort(function(e,t){return J(t,n)-J(e,n)}):A(e,n).filter(function(e){return e.id===t.id})).length>0&&i[0]}(t,n,r);if(o){K("WAR","".concat(t.name," prepares for war against ").concat(n.name),[t.id],r);var a=G(t,o,r);null===i&&(i=1-a),!D(i)?(K("WAR","".concat(t.name," succeeds in battle against ").concat(o.name),[t.id],r),U(P(a),[t.id,o.id],r),function(e,t,n){var i=$(t,n).map(function(e){return e.id});n.forEach(function(n){n.id===t.id&&(n.chief=e.id),i.indexOf(n.id)>-1&&(n.chief=null)})}(t,o,r),C(t,r),i-=.8*i,q(n,r).id!==t.id&&(K("WAR","".concat(t.name,"'s onslaught continues against ").concat(n.name),[t.id],r),e(t,n,i,r))):(K("WAR","".concat(t.name," fails in battle against ").concat(o.name),[t.id],r),U(H(a),[t.id,o.id],r))}else K("IMPASSE","".concat(n.name," has no communities with reach of ").concat(t.name,"'s assualt."),[t.id],r)},D=function(e){return Math.random()<=e},G=function(e,t,n){var i=Math.pow(J(e,n),2);return i/(i+Math.pow(J(t,n),2))},F=function(e,t,n){return t*Math.exp(-2*n)*(e.resource_level/e.baseline_resource_level)},P=function(e){return b*(1-e)},H=function(e){return b*e},U=function(e,t,n){n.forEach(function(n){t.indexOf(n.id)>-1&&(n.resource_level=Math.max(0,n.resource_level-e))})},z=function(e,t,n){n.forEach(function(n){t.indexOf(n.id)>-1&&(n.resource_level+=e)})},J=function(e,t){return $(e,t).reduce(function(e,t){return e+.5*t.resource_level},0)+e.resource_level},X=function(e,t){return t.filter(function(n){return n.id!==e.id&&q(n,t).id===e.id})},$=function(e,t){return t.filter(function(t){return t.id!==e.id&&t.chief===e.id})},q=function e(t,n){var i=!1,r=[];return null!==t.chief&&(r=n.filter(function(e){return e.id===t.chief})),r.length>0&&(i=r[0]),i?e(i,n):t},K=function(e,t,n,i){i.forEach(function(i){n.indexOf(i.id)>-1&&(i.events=i.events.concat(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"DEFAULT",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return{event:Q[e],message:t}}(e,t)))})},Q={DEFAULT:{color:"gray"},DECISION:{color:"green"},WAR:{color:"red"},PEACE:{color:"blue"},SECESSION:{color:"yellow"},ANNEX:{color:"orange"},DEATH:{color:"purple"},DISMANTLE:{color:"gray"},IMPASSE:{color:"gray"}},V=function(e){return e.map(function(e){return{events:Object(c.a)(e.events),polity_id:e.id}})},Y=function(e){var t=function(e,t){return e.reduce(function(e,n){return e+J(n,t)},0)}(e,e);return e.map(function(n){return{percent:J(n,e)/t,polity_id:n.id}})};function Z(e){var t=1+m(-1,1)*b;return{id:y()(),name:ie([te,ne]),baseline_resource_level:t,resource_level:t,chief:null,coordinates:{x:m(0,w),y:m(0,w)},has_incurred_secession:!1,has_incurred_war:!1,chief_age:30,events:[],color:e}}var ee=function(e){return e.has_incurred_secession&&e.has_incurred_war},te=["Moon","Sun","Black","White","Light","Shadow","Red","Green","Gray","Mighty","Wither","Gale","Hay","Stone","River"],ne=["Fire","Water","Belly","Peaks","Born","Still","Wood","Wine","Run","Guard","Fell","Fall"],ie=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){return(t=e).length>0?t[m(0,t.length-1)]:null;var t}).join(" ")},re={background:"#eadcbd",entity:["#de6640","#e39d96","#e8c4ac","#ebd66b","#638c5f","#869f9b","#cac9b4"]},oe=n(5),ae=(r.a.Component,function(){return{background:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#282c34",element_body:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#eadcbd",element_text:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#282c34",chart_lines:arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#eadcbd"}}),ce={dark:ae(),light:ae("#eadcbd","#282c34","#eadcbd","#282c34")},se=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(f.a)(this,Object(p.a)(t).call(this,e))).state={step_distance:100,entity_distance:40,offset_x:e.offset_x,offset_y:e.offset_y,previous_polity_power:0,padding_right:e.offset_x,event_text_width:60},n}return Object(_.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this,t=this.props.all_historical_polities.map(function(e){return{polity:e,points:[]}});this.props.history.map(function(n,i){return n.polities.map(function(r,o){var a=o>0?n.percents.slice(0,o).reduce(function(e,t){return e+t.percent},0):0,s=n.percents.filter(function(e){return e.polity_id===r.id})[0].percent,u=(e.props.width-e.state.offset_x)*(s+a),l=i*e.state.step_distance;return t=t.map(function(e){return e.polity.id===r.id&&(e.points=[].concat(Object(c.a)(e.points),[u,l])),e}),!0}),!0});var n=this.state.offset_x,i=this.state.offset_y,o=this.props.history.length*this.state.step_distance;return o>=this.props.height-this.state.offset_y&&(i=this.state.offset_y-o+(this.props.height-this.state.step_distance)),r.a.createElement(oe.Group,null,r.a.createElement(oe.Group,{draggable:!0,dragBoundFunc:function(e){return{x:0,y:Math.min(0,e.y)}}}),r.a.createElement(oe.Group,{x:n,y:i,draggable:!0,dragBoundFunc:function(t){return{x:e.state.offset_x,y:Math.min(e.state.offset_y,t.y)}}},t.map(function(t,n){var i=[];return e.props.history.forEach(function(t,n){n===e.props.history.length-1&&(i=(i=i.concat([0,n*e.state.step_distance])).concat([0,0]))}),r.a.createElement(oe.Line,{key:n,x:0,y:0,points:t.points.concat(i),stroke:ce[e.props.theme].background,tension:0,strokeWidth:4,closed:!0,fill:t.polity.color})}).reverse(),this.props.history.map(function(t,n){return r.a.createElement(oe.Group,null,r.a.createElement(oe.Text,{x:e.props.side_info_width-e.state.offset_x,y:n*e.state.step_distance-25,width:e.props.side_info_width,text:"".concat(n*e.props.years_to_run),fill:ce[e.props.theme].element_body,fontSize:20,fontStyle:"bold",align:"center"}),r.a.createElement(oe.Line,{key:n,x:0,y:0,points:[e.props.side_info_width-e.state.offset_x,n*e.state.step_distance,e.props.width-e.state.offset_x+e.props.side_info_width,n*e.state.step_distance],stroke:ce[e.props.theme].chart_lines,tension:0,strokeWidth:2}),r.a.createElement(oe.Text,{x:e.props.width-e.state.offset_x,y:n*e.state.step_distance-25,width:e.props.side_info_width,text:"".concat(n*e.props.years_to_run),fill:ce[e.props.theme].element_body,fontSize:20,fontStyle:"bold",align:"center"}))}),this.props.history.map(function(t,n){return t.polities.map(function(i,o){var a=o>0?t.percents.slice(0,o).reduce(function(e,t){return e+t.percent},0):0,c=t.percents.filter(function(e){return e.polity_id===i.id})[0].percent,s=(e.props.width-e.state.offset_x)*(c+a),u=(e.props.width-e.state.offset_x)*a,l=(e.state.event_text_width,t.events.filter(function(e){return e.polity_id===i.id})),d=l.length>0?l[0].events:[];if(c>.06)return r.a.createElement(oe.Group,{key:o},r.a.createElement(oe.Text,{x:u+16,y:n*e.state.step_distance-e.state.step_distance/2,width:s-u-16,text:"".concat(i.name.toUpperCase(),"\n").concat(d.length>0?d[d.length-1].message:"none"),fill:ce[e.props.theme].element_body,fontSize:12,fontStyle:"bold",align:"center"}))})})))}}]),t}(r.a.Component),ue=function(e){function t(){var e;Object(d.a)(this,t),e=Object(f.a)(this,Object(p.a)(t).call(this));var n=k(20),i=Y(n);return e.state={polities:n,all_historical_polities:n,chart_padding:180,side_info_width:80,width:window.innerWidth-180,height:window.innerHeight,history:[{polities:n,percents:i,events:[]}],years_to_run:10,step_interval:500},e}return Object(_.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=Object(l.a)(u.a.mark(function e(){var t;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.table(this.state.polities),t=0;case 2:if(!(t<10)){e.next=8;break}return e.next=5,this.step(this.state.years_to_run,this.state.step_interval/this.state.years_to_run);case 5:t++,e.next=2;break;case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"step",value:function(){var e=Object(l.a)(u.a.mark(function e(){var t,n,i,r,o,a,s=arguments;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:1,n=s.length>1&&void 0!==s[1]?s[1]:0,e.next=4,x(Object(c.a)(this.state.polities),t,n);case 4:i=e.sent,r=Y(i),o=V(i),a=this.state.history.concat({polities:i,percents:r,events:o}),this.setState({polities:i,history:a});case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("h1",{style:{color:ce[this.props.theme].element_body,margin:0}},"The HISTOMAP"),r.a.createElement("p",{style:{color:ce[this.props.theme].element_body}},"".concat(this.state.history.length*this.state.years_to_run," year").concat(this.state.history.length>1?"s":""," of world history").toUpperCase()),r.a.createElement("p",{style:{color:ce[this.props.theme].element_body}},"Relative power of contemporary states, nations, and empires".toUpperCase()),r.a.createElement("button",{onClick:function(){return e.step()},className:"btn",style:{backgroundColor:ce[this.props.theme].element_body,color:ce[this.props.theme].element_text}},"Step"),r.a.createElement("div",{className:"Stage"},r.a.createElement(oe.Stage,{width:this.state.width,height:this.state.height},r.a.createElement(oe.Layer,null,r.a.createElement(se,{theme:this.props.theme,polities:this.state.polities,all_historical_polities:this.state.all_historical_polities,history:this.state.history,years_to_run:this.state.years_to_run,side_info_width:this.state.side_info_width,width:this.state.width-this.state.side_info_width,height:this.state.height,offset_x:this.state.chart_padding,offset_y:85})))))}}]),t}(r.a.Component),le="light";var de=function(){return r.a.createElement("div",{className:"App",style:{backgroundColor:ce[le].background}},r.a.createElement(ue,{theme:le}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(r.a.createElement(de,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[41,1,2]]]);
//# sourceMappingURL=main.6eefdefe.chunk.js.map