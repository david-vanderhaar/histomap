(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{17:function(t,e,n){},42:function(t,e,n){t.exports=n(98)},46:function(t,e,n){},98:function(t,e,n){"use strict";n.r(e);var i=n(0),r=n.n(i),o=n(39),a=n.n(o),s=(n(46),n(41)),c=(n(17),n(9)),l=n(8),u=n.n(l),h=n(10),d=n(12),f=n(13),p=n(15),m=n(14),_=n(16);function y(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}var v=n(40),g=n.n(v),b=n(22),E=(n(28),.2),w=100,x=w,S=function(){var t=Object(h.a)(u.a.mark(function t(e,n){var i,r,o=arguments;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=o.length>2&&void 0!==o[2]?o[2]:0,r=0;case 2:if(!(r<n)){t.next=9;break}return e.map(function(t){return C(t,e)}),t.next=6,Object(b.delay)(i);case 6:r++,t.next=2;break;case 9:return t.abrupt("return",e);case 10:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}(),k=function(t){for(var e=[],n=0;n<t;n++){var i=ot.entity[n%ot.entity.length];e.push(tt(i))}return e},O=function(t,e){e.forEach(function(e){e.id===t.id&&(e.chief_age=y(12,45))})},C=function(t,e){if(R(t,e),function(t,e){var n=Math.random()<=t.chief_age/1e3-.3;return n&&q("DEATH","".concat(t.name,"'s Chief has died."),[t.id],e),n}(t,e))!function(t,e){var n=X(t,e),i=y(0,n.length);q("DISMANTLE","".concat(i," communities have decided to leave ").concat(t.name,"."),[t.id],e),n.map(function(t,n){return n<=i-1&&T(t,e),!0})}(t,e),O(t,e);else if(null===t.chief){q("DECISION","The chief polity ".concat(t.name," deliberates"),[t.id],e);var n=N(t,e);n&&I(t,n,e)?G(t,n,null,e):D(t,e)}else{var i=$(t,e);q("DECISION","".concat(i.name,"'s subordinate polity ").concat(t.name," deliberates"),[t.id],e),L(i,t,e)?W(i,t,e):D(t,e)}return t},N=function(t,e){var n=M(t,e).filter(function(t){return!et(t)}).map(function(t){return $(t,e)}).sort(function(t,n){return K(t,e)-K(n,e)});return n.length>0&&n[0]},j=function(t,e,n){return[t].concat(Object(c.a)(V(t,n))).reduce(function(t,n){return t+(i=e,r=n,x>=Math.hypot(r.coordinates.x-i.coordinates.x,r.coordinates.y-i.coordinates.y));var i,r},0)},M=function(t,e){return e.filter(function(n){return $(n,e).id!==t.id&&n.id!==t.id&&j(t,n,e)})},A=function(t,e){var n=[],i=V(t,e).sort(function(t,n){return K(n,e)-K(t,e)});i.length>4&&i.map(function(e,r){return r>=4?n.push({chief:i[r-4],target:e}):n.push({chief:t,target:e}),!0}),n.map(function(t){return e.forEach(function(e){e.id===t.target.id&&(e.chief=t.chief.id)}),!0})},T=function(t,e){var n=$(t,e);e.forEach(function(i){i.id===t.id?(q("SECESSION","".concat(i.name," is seceded from ").concat(n.name,"."),[i.id,n.id],e),i.chief=null):i.id===n.id&&(i.has_incurred_secession=!0)})},R=function(t,e){e.forEach(function(e){e.id===t.id&&(e.has_incurred_secession=!1,e.has_incurred_war=!1,e.chief_age+=1)})},I=function(t,e,n){var i=B(t,e,n),r=H(i);return Math.random()<=F(t,i,r)},L=function(t,e,n){var i=1-B(t,e,n);return Math.random()<=i},W=function(t,e,n){q("REBELLION","".concat(e.name," attempts rebellion against ").concat(t.name,"."),[e.id],n);var i=B(t,e,n);P(1-i)?(q("REBELLION","".concat(e.name," succeeds in rebellion against ").concat(t.name,"."),[e.id],n),z(U(i),[t.id,e.id],n),T(e,n),A($(t),n)):(q("REBELLION","".concat(e.name," fails in rebellion against ").concat(t.name,"."),[e.id],n),z(H(i),[t.id,e.id],n))},D=function(t,e){q("PEACE","".concat(t.name," has peace."),[t.id],e),J(Math.sign(t.baseline_resource_level-t.resource_level)*(t.baseline_resource_level/3),[t.id],e)},G=function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0,o=function(t,e,n){var i=[];return(i=V(e,n).length>0?M(t,n).filter(function(t){return $(t,n).id===e.id}).sort(function(t,e){return K(e,n)-K(t,n)}):M(t,n).filter(function(t){return t.id===e.id})).length>0&&i[0]}(e,n,r);if(o){q("WAR","".concat(e.name," prepares for war against ").concat(n.name),[e.id],r);var a=B(e,o,r);null===i&&(i=1-a),!P(i)?(q("WAR","".concat(e.name," succeeds in battle against ").concat(o.name),[e.id],r),z(H(a),[e.id,o.id],r),function(t,e,n){var i=X(e,n).map(function(t){return t.id});n.forEach(function(n){n.id===e.id&&(n.chief=t.id),i.indexOf(n.id)>-1&&(n.chief=null)})}(e,o,r),A(e,r),i-=.8*i,$(n,r).id!==e.id&&(q("WAR","".concat(e.name,"'s onslaught continues against ").concat(n.name),[e.id],r),t(e,n,i,r))):(q("WAR","".concat(e.name," fails in battle against ").concat(o.name),[e.id],r),z(U(a),[e.id,o.id],r))}else q("IMPASSE","".concat(n.name," has no communities with reach of ").concat(e.name,"'s assualt."),[e.id],r)},P=function(t){return Math.random()<=t},B=function(t,e,n){var i=Math.pow(K(t,n),2);return i/(i+Math.pow(K(e,n),2))},F=function(t,e,n){return e*Math.exp(-2*n)*(t.resource_level/t.baseline_resource_level)},H=function(t){return E*(1-t)},U=function(t){return E*t},z=function(t,e,n){n.forEach(function(n){e.indexOf(n.id)>-1&&(n.resource_level=Math.max(0,n.resource_level-t))})},J=function(t,e,n){n.forEach(function(n){e.indexOf(n.id)>-1&&(n.resource_level+=t)})},K=function(t,e){return X(t,e).reduce(function(t,e){return t+.5*e.resource_level},0)+t.resource_level},V=function(t,e){return e.filter(function(n){return n.id!==t.id&&$(n,e).id===t.id})},X=function(t,e){return e.filter(function(e){return e.id!==t.id&&e.chief===t.id})},$=function t(e,n){var i=!1,r=[];return null!==e.chief&&(r=n.filter(function(t){return t.id===e.chief})),r.length>0&&(i=r[0]),i?t(i,n):e},q=function(t,e,n,i){i.forEach(function(i){n.indexOf(i.id)>-1&&(i.events=i.events.concat(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"DEFAULT",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return{event:Q[t],message:e}}(t,e)))})},Q={DEFAULT:{color:"gray"},DECISION:{color:"green"},WAR:{color:"red"},PEACE:{color:"blue"},SECESSION:{color:"yellow"},ANNEX:{color:"orange"},DEATH:{color:"purple"},DISMANTLE:{color:"gray"},IMPASSE:{color:"gray"}},Y=function(t){return t.map(function(t){return{events:Object(c.a)(t.events),polity_id:t.id}})},Z=function(t){var e=function(t,e){return t.reduce(function(t,n){return t+K(n,e)},0)}(t,t);return t.map(function(n){return{percent:K(n,t)/e,polity_id:n.id}})};function tt(t){var e=1+y(-1,1)*E;return{id:g()(),name:rt([nt,it]),baseline_resource_level:e,resource_level:e,chief:null,coordinates:{x:y(0,w),y:y(0,w)},has_incurred_secession:!1,has_incurred_war:!1,chief_age:30,events:[],color:t}}var et=function(t){return t.has_incurred_secession&&t.has_incurred_war},nt=["Moon","Sun","Black","White","Light","Shadow","Red","Green","Gray","Mighty","Wither","Gale","Hay","Stone","River"],it=["Fire","Water","Belly","Peaks","Born","Still","Wood","Wine","Run","Guard","Fell","Fall"],rt=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(t){return(e=t).length>0?e[y(0,e.length-1)]:null;var e}).join(" ")},ot={background:"#eadcbd",entity:["#de6640","#e39d96","#e8c4ac","#ebd66b","#638c5f","#869f9b","#cac9b4"]},at=n(6),st=(r.a.Component,function(){return{background:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#282c34",element_body:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#eadcbd",element_text:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#282c34",chart_lines:arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#eadcbd"}}),ct={dark:st(),light:st("#eadcbd","#282c34","#eadcbd","#282c34")},lt=function(t){function e(t){var n;return Object(d.a)(this,e),(n=Object(p.a)(this,Object(m.a)(e).call(this,t))).state={step_distance:100,entity_distance:40,offset_x:t.offset_x,offset_y:t.offset_y,previous_polity_power:0,padding_right:t.offset_x,event_text_width:60},n}return Object(_.a)(e,t),Object(f.a)(e,[{key:"render",value:function(){var t=this,e=this.props.all_historical_polities.map(function(t){return{polity:t,points:[]}});this.props.history.map(function(n,i){return n.polities.map(function(r,o){var a=o>0?n.percents.slice(0,o).reduce(function(t,e){return t+e.percent},0):0,s=n.percents.filter(function(t){return t.polity_id===r.id})[0].percent,l=(t.props.width-t.state.offset_x)*(s+a),u=i*t.state.step_distance;return e=e.map(function(t){return t.polity.id===r.id&&(t.points=[].concat(Object(c.a)(t.points),[l,u])),t}),!0}),!0});var n=this.state.offset_x,i=this.state.offset_y,o=this.props.history.length*this.state.step_distance;return o>=this.props.height-this.state.offset_y&&(i=this.state.offset_y-o+(this.props.height-this.state.step_distance)),r.a.createElement(at.Group,null,r.a.createElement(at.Group,{x:n,y:i,draggable:!0,dragBoundFunc:function(e){return{x:t.state.offset_x,y:Math.min(t.state.offset_y,e.y)}}},e.map(function(e,n){var i=[];return t.props.history.forEach(function(e,n){n===t.props.history.length-1&&(i=(i=i.concat([0,n*t.state.step_distance])).concat([0,0]))}),r.a.createElement(at.Line,{key:n,x:0,y:0,points:e.points.concat(i),stroke:ct[t.props.theme].background,tension:0,strokeWidth:4,closed:!0,fill:e.polity.color})}).reverse(),this.props.history.map(function(e,n){return r.a.createElement(at.Group,null,r.a.createElement(at.Text,{x:t.props.side_info_width-t.state.offset_x,y:n*t.state.step_distance-25,width:t.props.side_info_width,text:"".concat(n*t.props.years_to_run),fill:ct[t.props.theme].element_body,fontSize:20,fontStyle:"bold",align:"center"}),r.a.createElement(at.Line,{key:n,x:0,y:0,points:[t.props.side_info_width-t.state.offset_x,n*t.state.step_distance,t.props.width-t.state.offset_x+t.props.side_info_width,n*t.state.step_distance],stroke:ct[t.props.theme].chart_lines,tension:0,strokeWidth:2}),r.a.createElement(at.Text,{x:t.props.width-t.state.offset_x,y:n*t.state.step_distance-25,width:t.props.side_info_width,text:"".concat(n*t.props.years_to_run),fill:ct[t.props.theme].element_body,fontSize:20,fontStyle:"bold",align:"center"}))}),this.props.history.map(function(e,n){return e.polities.map(function(i,o){var a=o>0?e.percents.slice(0,o).reduce(function(t,e){return t+e.percent},0):0,s=e.percents.filter(function(t){return t.polity_id===i.id})[0].percent,c=(t.props.width-t.state.offset_x)*(s+a),l=(t.props.width-t.state.offset_x)*a,u=(t.state.event_text_width,e.events.filter(function(t){return t.polity_id===i.id})),h=u.length>0?u[0].events:[];if(s>.06)return r.a.createElement(at.Group,{key:o},r.a.createElement(at.Text,{x:l+16,y:n*t.state.step_distance-t.state.step_distance/2,width:c-l-16,text:"".concat(i.name.toUpperCase(),"\n").concat(h.length>0?h[h.length-1].message:"none"),fill:ct[t.props.theme].element_body,fontSize:12,fontStyle:"bold",align:"center"}))})})))}}]),e}(r.a.Component);var ut=function(t){return r.a.createElement("div",{className:"Toolbar"},r.a.createElement("button",{onClick:function(){t.running_sim?t.onPause():t.onStart()},className:"btn",style:{backgroundColor:ct[t.theme].element_body,color:ct[t.theme].element_text}},t.running_sim?"Pause":"Start"),r.a.createElement("button",{onClick:function(){return t.onStep()},className:"btn",style:{backgroundColor:ct[t.theme].element_body,color:ct[t.theme].element_text}},"Step"),r.a.createElement("button",{onClick:function(){return t.onRestart()},className:"btn",style:{backgroundColor:ct[t.theme].element_body,color:ct[t.theme].element_text}},"Restart"),r.a.createElement("button",{onClick:function(){return t.onReset()},className:"btn",style:{backgroundColor:ct[t.theme].element_body,color:ct[t.theme].element_text}},"New History"),r.a.createElement("button",{onClick:function(){return t.onSwitchTheme()},className:"btn",style:{backgroundColor:ct[t.theme].element_body,color:ct[t.theme].element_text}},"light"===t.theme?"Go Dark":"Go Light"))},ht=function(t){function e(){var t;Object(d.a)(this,e),t=Object(p.a)(this,Object(m.a)(e).call(this));var n=k(20),i=Z(n);return t.state={polities:n,all_historical_polities:n,chart_padding:180,side_info_width:80,width:window.innerWidth-180,height:window.innerHeight-280,stage_padding_top:20,top_section_height:200,bottom_section_height:60,history:[{polities:n,percents:i,events:[]}],years_to_run:10,running_sim:!1,running_sim_reference:null,step_interval:500},t}return Object(_.a)(e,t),Object(f.a)(e,[{key:"componentDidMount",value:function(){var t=Object(h.a)(u.a.mark(function t(){return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:console.table(this.state.polities);case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"start",value:function(){var t=Object(h.a)(u.a.mark(function t(){return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.setState({running_sim:!0});case 2:return t.next=4,this.continuousStep(this.state.years_to_run,this.state.step_interval/this.state.years_to_run);case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"pause",value:function(){this.setState({running_sim:!1})}},{key:"continuousStep",value:function(){var t=Object(h.a)(u.a.mark(function t(){var e,n,i,r,o,a,s=arguments;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=s.length>0&&void 0!==s[0]?s[0]:1,n=s.length>1&&void 0!==s[1]?s[1]:0,t.next=4,S(Object(c.a)(this.state.polities),e,n);case 4:return i=t.sent,r=Z(i),o=Y(i),a=this.state.history.concat({polities:i,percents:r,events:o}),t.next=10,this.setState({polities:i,history:a});case 10:return t.next=12,Object(b.delay)(this.state.step_interval);case 12:if(!this.state.running_sim){t.next=15;break}return t.next=15,this.continuousStep(e,n/e);case 15:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"step",value:function(){var t=Object(h.a)(u.a.mark(function t(){var e,n,i,r,o,a,s=arguments;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=s.length>0&&void 0!==s[0]?s[0]:1,n=s.length>1&&void 0!==s[1]?s[1]:0,t.next=4,S(Object(c.a)(this.state.polities),e,n);case 4:return i=t.sent,r=Z(i),o=Y(i),a=this.state.history.concat({polities:i,percents:r,events:o}),t.next=10,this.setState({polities:i,history:a});case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"reset",value:function(){var t=k(20),e=[{polities:t,percents:Z(t),events:[]}];this.setState({polities:t,all_historical_polities:t,history:e})}},{key:"restart",value:function(){var t=this.state.all_historical_polities,e=[{polities:t,percents:Z(t),events:[]}];this.setState({polities:t,history:e})}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",{className:"top-section",style:{height:this.state.top_section_height}},r.a.createElement("h1",{style:{color:ct[this.props.theme].element_body,margin:0}},"The HISTOMAP"),r.a.createElement("p",{style:{color:ct[this.props.theme].element_body}},"".concat((this.state.history.length-1)*this.state.years_to_run," year").concat(this.state.history.length>1?"s":""," of world history").toUpperCase()),r.a.createElement("p",{style:{color:ct[this.props.theme].element_body}},"Relative power of contemporary states, nations, and empires".toUpperCase()),r.a.createElement(ut,{theme:this.props.theme,running_sim:this.state.running_sim,onStart:this.start.bind(this),onPause:this.pause.bind(this),onStep:this.step.bind(this),onReset:this.reset.bind(this),onRestart:this.restart.bind(this),onSwitchTheme:this.props.onSwitchTheme})),r.a.createElement("div",{className:"Stage",style:{paddingTop:this.state.stage_padding_top}},r.a.createElement(at.Stage,{width:this.state.width,height:this.state.height},r.a.createElement(at.Layer,null,r.a.createElement(lt,{theme:this.props.theme,polities:this.state.polities,all_historical_polities:this.state.all_historical_polities,history:this.state.history,years_to_run:this.state.years_to_run,side_info_width:this.state.side_info_width,width:this.state.width-this.state.side_info_width,height:this.state.height-this.state.stage_padding_top,offset_x:this.state.chart_padding,offset_y:85})))),r.a.createElement("div",{className:"bottom-section",style:{height:this.state.bottom_section_height}},r.a.createElement("span",{style:{color:ct[this.props.theme].element_body},className:"bottom-section-text"},"Copyright by David A. Vanderhaar"),r.a.createElement("span",{style:{color:ct[this.props.theme].element_body},className:"bottom-section-text"},"Made with React and Konva"),r.a.createElement("span",{style:{color:ct[this.props.theme].element_body},className:"bottom-section-text"},"Model based on Peter Turchin's Cycling in the Complexity of Early Societies")))}}]),e}(r.a.Component),dt=function(t){return"light"===t?"dark":"light"};var ft=function(){var t=Object(i.useState)("light"),e=Object(s.a)(t,2),n=e[0],o=e[1];return r.a.createElement("div",{className:"App",style:{backgroundColor:ct[n].background}},r.a.createElement(ht,{onSwitchTheme:function(){o(dt(n))},theme:n}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(r.a.createElement(ft,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[42,1,2]]]);
//# sourceMappingURL=main.9c843a24.chunk.js.map