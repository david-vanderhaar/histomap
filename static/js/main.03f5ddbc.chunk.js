(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{19:function(t,e,n){},41:function(t,e,n){t.exports=n(97)},45:function(t,e,n){},97:function(t,e,n){"use strict";n.r(e);var i=n(0),r=n.n(i),o=n(38),a=n.n(o),s=(n(45),n(19),n(9)),c=n(8),l=n.n(c),u=n(17),h=n(11),d=n(12),f=n(14),p=n(13),_=n(15);function m(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}var y=n(39),v=n.n(y),g=n(40),b=(n(27),.2),E=100,w=E,x=function(){var t=Object(u.a)(l.a.mark(function t(e,n){var i,r,o=arguments;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=o.length>2&&void 0!==o[2]?o[2]:0,r=0;case 2:if(!(r<n)){t.next=9;break}return e.map(function(t){return S(t,e)}),t.next=6,Object(g.delay)(i);case 6:r++,t.next=2;break;case 9:return t.abrupt("return",e);case 10:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}(),k=function(t){for(var e=[],n=0;n<t;n++){var i=rt.entity[n%rt.entity.length];e.push(Z(i))}return e},O=function(t,e){e.forEach(function(e){e.id===t.id&&(e.chief_age=m(12,45))})},S=function(t,e){if(I(t,e),function(t,e){var n=Math.random()<=t.chief_age/1e3-.3;return n&&$("DEATH","".concat(t.name,"'s Chief has died."),[t.id],e),n}(t,e))!function(t,e){var n=V(t,e),i=m(0,n.length);$("DISMANTLE","".concat(i," communities have decided to leave ").concat(t.name,"."),[t.id],e),n.map(function(t,n){return n<=i-1&&A(t,e),!0})}(t,e),O(t,e);else if(null===t.chief){$("DECISION","The chief polity ".concat(t.name," deliberates"),[t.id],e);var n=M(t,e);n&&W(t,n,e)?D(t,n,null,e):R(t,e)}else{var i=X(t,e);$("DECISION","".concat(i.name,"'s subordinate polity ").concat(t.name," deliberates"),[t.id],e),L(i,t,e)?T(i,t,e):R(t,e)}return t},M=function(t,e){var n=N(t,e).filter(function(t){return!tt(t)}).map(function(t){return X(t,e)}).sort(function(t,n){return J(t,e)-J(n,e)});return n.length>0&&n[0]},C=function(t,e,n){return[t].concat(Object(s.a)(K(t,n))).reduce(function(t,n){return t+(i=e,r=n,w>=Math.hypot(r.coordinates.x-i.coordinates.x,r.coordinates.y-i.coordinates.y));var i,r},0)},N=function(t,e){return e.filter(function(n){return X(n,e).id!==t.id&&n.id!==t.id&&C(t,n,e)})},j=function(t,e){var n=[],i=K(t,e).sort(function(t,n){return J(n,e)-J(t,e)});i.length>4&&i.map(function(e,r){return r>=4?n.push({chief:i[r-4],target:e}):n.push({chief:t,target:e}),!0}),n.map(function(t){return e.forEach(function(e){e.id===t.target.id&&(e.chief=t.chief.id)}),!0})},A=function(t,e){var n=X(t,e);e.forEach(function(i){i.id===t.id?($("SECESSION","".concat(i.name," is seceded from ").concat(n.name,"."),[i.id,n.id],e),i.chief=null):i.id===n.id&&(i.has_incurred_secession=!0)})},I=function(t,e){e.forEach(function(e){e.id===t.id&&(e.has_incurred_secession=!1,e.has_incurred_war=!1,e.chief_age+=1)})},W=function(t,e,n){var i=G(t,e,n),r=F(i);return Math.random()<=P(t,i,r)},L=function(t,e,n){var i=1-G(t,e,n);return Math.random()<=i},T=function(t,e,n){$("REBELLION","".concat(e.name," attempts rebellion against ").concat(t.name,"."),[e.id],n);var i=G(t,e,n);B(1-i)?($("REBELLION","".concat(e.name," succeeds in rebellion against ").concat(t.name,"."),[e.id],n),U(H(i),[t.id,e.id],n),A(e,n),j(X(t),n)):($("REBELLION","".concat(e.name," fails in rebellion against ").concat(t.name,"."),[e.id],n),U(F(i),[t.id,e.id],n))},R=function(t,e){$("PEACE","".concat(t.name," has peace."),[t.id],e),z(Math.sign(t.baseline_resource_level-t.resource_level)*(t.baseline_resource_level/3),[t.id],e)},D=function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0,o=function(t,e,n){var i=[];return(i=K(e,n).length>0?N(t,n).filter(function(t){return X(t,n).id===e.id}).sort(function(t,e){return J(e,n)-J(t,n)}):N(t,n).filter(function(t){return t.id===e.id})).length>0&&i[0]}(e,n,r);if(o){$("WAR","".concat(e.name," prepares for war against ").concat(n.name),[e.id],r);var a=G(e,o,r);null===i&&(i=1-a),!B(i)?($("WAR","".concat(e.name," succeeds in battle against ").concat(o.name),[e.id],r),U(F(a),[e.id,o.id],r),function(t,e,n){var i=V(e,n).map(function(t){return t.id});n.forEach(function(n){n.id===e.id&&(n.chief=t.id),i.indexOf(n.id)>-1&&(n.chief=null)})}(e,o,r),j(e,r),i-=.8*i,X(n,r).id!==e.id&&($("WAR","".concat(e.name,"'s onslaught continues against ").concat(n.name),[e.id],r),t(e,n,i,r))):($("WAR","".concat(e.name," fails in battle against ").concat(o.name),[e.id],r),U(H(a),[e.id,o.id],r))}else $("IMPASSE","".concat(n.name," has no communities with reach of ").concat(e.name,"'s assualt."),[e.id],r)},B=function(t){return Math.random()<=t},G=function(t,e,n){var i=Math.pow(J(t,n),2);return i/(i+Math.pow(J(e,n),2))},P=function(t,e,n){return e*Math.exp(-2*n)*(t.resource_level/t.baseline_resource_level)},F=function(t){return b*(1-t)},H=function(t){return b*t},U=function(t,e,n){n.forEach(function(n){e.indexOf(n.id)>-1&&(n.resource_level=Math.max(0,n.resource_level-t))})},z=function(t,e,n){n.forEach(function(n){e.indexOf(n.id)>-1&&(n.resource_level+=t)})},J=function(t,e){return V(t,e).reduce(function(t,e){return t+.5*e.resource_level},0)+t.resource_level},K=function(t,e){return e.filter(function(n){return n.id!==t.id&&X(n,e).id===t.id})},V=function(t,e){return e.filter(function(e){return e.id!==t.id&&e.chief===t.id})},X=function t(e,n){var i=!1,r=[];return null!==e.chief&&(r=n.filter(function(t){return t.id===e.chief})),r.length>0&&(i=r[0]),i?t(i,n):e},$=function(t,e,n,i){i.forEach(function(i){n.indexOf(i.id)>-1&&(i.events=i.events.concat(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"DEFAULT",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return{event:q[t],message:e}}(t,e)))})},q={DEFAULT:{color:"gray"},DECISION:{color:"green"},WAR:{color:"red"},PEACE:{color:"blue"},SECESSION:{color:"yellow"},ANNEX:{color:"orange"},DEATH:{color:"purple"},DISMANTLE:{color:"gray"},IMPASSE:{color:"gray"}},Q=function(t){var e=t.length;return t.map(function(n){return{percent:K(n,t).length/e,polity_id:n.id}})},Y=function(t){return t.map(function(t){return{events:Object(s.a)(t.events),polity_id:t.id}})};function Z(t){var e=1+m(-1,1)*b;return{id:v()(),name:it([et,nt]),baseline_resource_level:e,resource_level:e,chief:null,coordinates:{x:m(0,E),y:m(0,E)},has_incurred_secession:!1,has_incurred_war:!1,chief_age:30,events:[],color:t}}var tt=function(t){return t.has_incurred_secession&&t.has_incurred_war},et=["Moon","Sun","Black","White","Light","Shadow","Red","Green","Gray","Mighty","Wither","Gale","Hay","Stone","River"],nt=["Fire","Water","Belly","Peaks","Born","Still","Wood","Wine","Run","Guard","Fell","Fall"],it=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(t){return(e=t).length>0?e[m(0,e.length-1)]:null;var e}).join(" ")},rt={background:"#eadcbd",entity:["#de6640","#e39d96","#e8c4ac","#ebd66b","#638c5f","#869f9b","#cac9b4"]},ot=n(6),at=(r.a.Component,function(){return{background:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#282c34",element_body:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#eadcbd",element_text:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#282c34",chart_lines:arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#eadcbd"}}),st={dark:at(),light:at("#eadcbd","#282c34","#eadcbd","#282c34")},ct=function(t){function e(t){var n;return Object(h.a)(this,e),(n=Object(f.a)(this,Object(p.a)(e).call(this,t))).state={step_distance:100,entity_distance:40,offset_x:t.offset_x,offset_y:t.offset_y,previous_polity_power:0,padding_right:t.offset_x,event_text_width:60},n}return Object(_.a)(e,t),Object(d.a)(e,[{key:"render",value:function(){var t=this,e=this.props.all_historical_polities.map(function(t){return{polity:t,points:[]}});this.props.history.map(function(n,i){return n.polities.map(function(r,o){var a=o>0?n.percents.slice(0,o).reduce(function(t,e){return t+e.percent},0):0,c=n.percents.filter(function(t){return t.polity_id===r.id})[0].percent,l=(t.props.width-t.state.offset_x)*(c+a),u=i*t.state.step_distance;return e=e.map(function(t){return t.polity.id===r.id&&(t.points=[].concat(Object(s.a)(t.points),[l,u])),t}),!0}),!0});var n=this.state.offset_x,i=this.state.offset_y,o=this.props.history.length*this.state.step_distance;return o>=this.props.height-this.state.offset_y&&(i=this.state.offset_y-o+(this.props.height-this.state.step_distance)),r.a.createElement(ot.Group,null,r.a.createElement(ot.Group,{x:n,y:i,draggable:!0,dragBoundFunc:function(e){return{x:t.state.offset_x,y:Math.min(t.state.offset_y,e.y)}}},e.map(function(e,n){var i=[];return t.props.history.forEach(function(e,n){n===t.props.history.length-1&&(i=(i=i.concat([0,n*t.state.step_distance])).concat([0,0]))}),r.a.createElement(ot.Line,{key:n,x:0,y:0,points:e.points.concat(i),stroke:st[t.props.theme].background,tension:0,strokeWidth:4,closed:!0,fill:e.polity.color})}).reverse(),this.props.history.map(function(e,n){return r.a.createElement(ot.Group,null,r.a.createElement(ot.Text,{x:t.props.side_info_width-t.state.offset_x,y:n*t.state.step_distance-25,width:t.props.side_info_width,text:"".concat(n*t.props.years_to_run),fill:st[t.props.theme].element_body,fontSize:20,fontStyle:"bold",align:"center"}),r.a.createElement(ot.Line,{key:n,x:0,y:0,points:[t.props.side_info_width-t.state.offset_x,n*t.state.step_distance,t.props.width-t.state.offset_x+t.props.side_info_width,n*t.state.step_distance],stroke:st[t.props.theme].chart_lines,tension:0,strokeWidth:2}),r.a.createElement(ot.Text,{x:t.props.width-t.state.offset_x,y:n*t.state.step_distance-25,width:t.props.side_info_width,text:"".concat(n*t.props.years_to_run),fill:st[t.props.theme].element_body,fontSize:20,fontStyle:"bold",align:"center"}))}),this.props.history.map(function(e,n){return e.polities.map(function(i,o){var a=o>0?e.percents.slice(0,o).reduce(function(t,e){return t+e.percent},0):0,s=e.percents.filter(function(t){return t.polity_id===i.id})[0].percent,c=(t.props.width-t.state.offset_x)*(s+a),l=(t.props.width-t.state.offset_x)*a,u=(t.state.event_text_width,e.events.filter(function(t){return t.polity_id===i.id})),h=u.length>0?u[0].events:[];if(s>.06)return r.a.createElement(ot.Group,{key:o},r.a.createElement(ot.Text,{x:l+16,y:n*t.state.step_distance-t.state.step_distance/2,width:c-l-16,text:"".concat(i.name.toUpperCase(),"\n").concat(h.length>0?h[h.length-1].message:"none"),fill:st[t.props.theme].element_body,fontSize:12,fontStyle:"bold",align:"center"}))})})))}}]),e}(r.a.Component),lt=function(t){function e(){var t;Object(h.a)(this,e),t=Object(f.a)(this,Object(p.a)(e).call(this));var n=k(20),i=Q(n);return t.state={polities:n,all_historical_polities:n,chart_padding:180,side_info_width:80,width:window.innerWidth-180,height:window.innerHeight-280,stage_padding_top:20,top_section_height:200,bottom_section_height:60,history:[{polities:n,percents:i,events:[]}],years_to_run:10,step_interval:500},t}return Object(_.a)(e,t),Object(d.a)(e,[{key:"componentDidMount",value:function(){var t=Object(u.a)(l.a.mark(function t(){var e;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:console.table(this.state.polities),e=0;case 2:if(!(e<10)){t.next=8;break}return t.next=5,this.step(this.state.years_to_run,this.state.step_interval/this.state.years_to_run);case 5:e++,t.next=2;break;case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"step",value:function(){var t=Object(u.a)(l.a.mark(function t(){var e,n,i,r,o,a,c=arguments;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=c.length>0&&void 0!==c[0]?c[0]:1,n=c.length>1&&void 0!==c[1]?c[1]:0,t.next=4,x(Object(s.a)(this.state.polities),e,n);case 4:i=t.sent,r=Q(i),o=Y(i),a=this.state.history.concat({polities:i,percents:r,events:o}),this.setState({polities:i,history:a});case 9:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"top-section",style:{height:this.state.top_section_height}},r.a.createElement("h1",{style:{color:st[this.props.theme].element_body,margin:0}},"The HISTOMAP"),r.a.createElement("p",{style:{color:st[this.props.theme].element_body}},"".concat(this.state.history.length*this.state.years_to_run," year").concat(this.state.history.length>1?"s":""," of world history").toUpperCase()),r.a.createElement("p",{style:{color:st[this.props.theme].element_body}},"Relative power of contemporary states, nations, and empires".toUpperCase()),r.a.createElement("button",{onClick:function(){return t.step()},className:"btn",style:{backgroundColor:st[this.props.theme].element_body,color:st[this.props.theme].element_text}},"Step")),r.a.createElement("div",{className:"Stage",style:{paddingTop:this.state.stage_padding_top}},r.a.createElement(ot.Stage,{width:this.state.width,height:this.state.height},r.a.createElement(ot.Layer,null,r.a.createElement(ct,{theme:this.props.theme,polities:this.state.polities,all_historical_polities:this.state.all_historical_polities,history:this.state.history,years_to_run:this.state.years_to_run,side_info_width:this.state.side_info_width,width:this.state.width-this.state.side_info_width,height:this.state.height-this.state.stage_padding_top,offset_x:this.state.chart_padding,offset_y:85})))),r.a.createElement("div",{className:"bottom-section",style:{height:this.state.bottom_section_height}},r.a.createElement("span",{style:{color:st[this.props.theme].element_body},className:"bottom-section-text"},"Copyright by David A. Vanderhaar"),r.a.createElement("span",{style:{color:st[this.props.theme].element_body},className:"bottom-section-text"},"Made with React and Konva"),r.a.createElement("span",{style:{color:st[this.props.theme].element_body},className:"bottom-section-text"},"Model based on Peter Turchin's Cycling in the Complexity of Early Societies")))}}]),e}(r.a.Component),ut="light";var ht=function(){return r.a.createElement("div",{className:"App",style:{backgroundColor:st[ut].background}},r.a.createElement(lt,{theme:ut}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(r.a.createElement(ht,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[41,1,2]]]);
//# sourceMappingURL=main.03f5ddbc.chunk.js.map