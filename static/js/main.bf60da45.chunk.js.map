{"version":3,"sources":["lib/helper.js","lib/turchin_cycling.js","histomap/NodeView.js","styles.js","histomap/ChartView.js","histomap/components/Toolbar.js","histomap/components/Sidenav.js","Histomap.js","App.js","serviceWorker.js","index.js"],"names":["getRandomIntInclusive","min","max","Math","ceil","floor","random","RESOURCE_BASELINE_DEVIATION","GRID_SIZE","NEIGHBOR_DISTANCE","run","_ref","Object","asyncToGenerator","regenerator_default","a","mark","_callee","polities","steps_to_run","step_interval","autoResolvePlayerDecisions","i","_args","arguments","wrap","_context","prev","next","length","undefined","map","polity","isPlayer","chooseDecision","makeDecision","delay","abrupt","stop","_x","_x2","apply","this","generatePolities","amount","color","getNextColor","push","createPolity","hasChiefDied","all_polities","has_died","chief_age","addEvent","concat","name","id","electChief","forEach","p","dismantlePolity","subordinates","getImmediateSubordinates","amount_to_secede","s","secede","upkeep","chief","victim","findWeakestNeighborPolity","willGoToWar","goToWar","havePeace","chief_polity","getChiefPolity","willSecede","attemptRebellion","informPlayer","choose_rebellion","promptPlayer","should_rebel","chooses_seek_war","chooses_war","should_war","neighbor_chiefs","getNeighborCommunities","filter","c","immuneToViolence","sort","b","getPower","isInRangeOfChiefOrSubordinates","toConsumableArray","getAllSubordinates","reduce","acc","curr","hypot","coordinates","x","y","reorganizeInternalPolities","annex_pairs","target","pair","has_incurred_secession","has_incurred_war","neighbor","P","probabilityOfSuccessfulAttack","costOfSuccessfulAttack","probabilityPolityWillAttack","subordinate","probability_to_repel_attack","probability_of_successful_attack","attackRepelled","decreaseResourceBy","costOfUnsuccessfulAttack","increaseResourceBy","sign","baseline_resource_level","resource_level","attacker","defender","target_community","neighbor_communities","findWealthiestBorderCommunity","target_subordinate_ids","t","indexOf","annexTarget","p1","pow","cost_of_successful_attack","exp","value","ids","result","type","message","events","event","EVENT_TYPES","createEvent","label_yes","label_no","window","confirm","alert","DEFAULT","DECISION","WAR","PEACE","SECESSION","ANNEX","DEATH","DISMANTLE","IMPASSE","getEvents","polity_id","getPowerPercentages","total_power","getTotalPower","percent","uuid","composeName","namePrefixes","nameSuffixes","list","array","join","COLORS","background","entity","CURRENT_COLOR_INDEX","NodeView","props","_this","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","state","offset_x","width","offset_y","height","base_size","size_multiplier","_this2","chief_pos_x","chief_pos_y","power","Cycling","size","subordinate_lines","react_default","createElement","ReactKonva","key","points","stroke","tension","strokeWidth","text","fill","fontSize","round","shadowBlur","React","Component","createTheme","element_body","element_text","chart_lines","themes","dark","light","getStepPercentageByPolity","step","found_polity","percents","per","ChartView","step_distance","entity_distance","previous_polity_power","padding_right","event_text_width","lines","all_historical_polities","history","j","all_previous_percents","slice","percentage","line","chart_pos_x","chart_pos_y","chart_height","draggable","dragBoundFunc","pos","k","extra_points","l","Styles","theme","closed","reverse","side_info_width","years_to_run","fontStyle","align","x_end","x_begin","polity_events","e","event_log","toUpperCase","Toolbar","className","onClick","running_sim","onPause","onStart","title","style","backgroundColor","onStep","onRestart","onReset","onAddTurchinPolity","onAddPlayerPolity","onSwitchTheme","onSwitchView","chart_view","useStyles","makeStyles","fullList","TemporaryDrawer","side","classes","_React$useState","useState","top","left","bottom","right","_React$useState2","slicedToArray","setState","toggleDrawer","open","objectSpread","defineProperty","ListItemLink","ListItem","assign","button","component","Button","disableFocusRipple","position","borderRadius","Menu_default","Drawer","PaperProps","onClose","role","onKeyDown","List","ListItemText","Divider","href","primary","Histomap","chart_padding","innerWidth","innerHeight","stage_padding_top","top_section_height","bottom_section_height","running_sim_reference","stage_ref","createRef","console","table","continuousStep","new_polity","addPolity","margin","components_Toolbar","start","bind","pause","reset","restart","addTurchinPolity","addPlayerPolity","paddingTop","ref","histomap_ChartView","histomap_NodeView","switchTheme","App","_useState","_useState2","setTheme","src_Histomap","Boolean","location","hostname","match","ReactDOM","render","src_App","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.bf60da45.chunk.js","sourcesContent":["export function getRandomIntInclusive (min, max) {\r\n  min = Math.ceil(min);\r\n  max = Math.floor(max);\r\n  return Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\n\r\nexport function getRandomInArray (array) {\r\n  return array.length > 0 \r\n    ? array[getRandomIntInclusive(0, array.length - 1)]\r\n    : null\r\n}","import { getRandomIntInclusive, getRandomInArray } from \"./helper\";\r\nimport uuid from 'uuid/v1';\r\nimport { delay } from \"q\";\r\nimport Konva from 'konva';\r\n\r\n/*\r\n----------------------\r\n      VARIABLES\r\n----------------------\r\nMajor model parameters and statistics\r\nS = System edge size\r\nMILITARY_DETERMINISM = Scaling exponent (of the polity power to the probability of a win)\r\nRESOURCE_BASELINE_DEVIATION = Standard deviation of the baseline resource level\r\nTRIBUTE_LEVEL = Tribute level\r\nWILLINGNESS_TO_ATTACK = a variable > 0\r\nMAX_CONTROL = Span of control (the maximum number of subordinate polities)\r\nCHIEF_LIFE_EXPECTANCY = The expected time in power of the paramount chief\r\nmax_s = Relative size of the largest polity\r\nc = Mean complexity\r\nmax_c = Maximum complexity\r\nÏ = Average centrality (i.e. the ratio of the power of the chief village and the one immediately below)\r\n\r\nCustom model parameters\r\nN = initial number of polities to create\r\nC = max number of connection to other nodes\r\nY = number of time steps to run\r\ntime_step = current step in time\r\n\r\n----------------------\r\n      TODO's\r\n----------------------\r\nCreate visual log of polity actions\r\n\r\nCreate area interpretation which breaks the screen into chunks and \r\ncolor codes swathes of land via the chief polity (shapes)\r\n\r\nCreate Histomap graph (printable, scrollable) which includes power shifts and significant events\r\n\r\nDONE - There is a chance t every time_step that the paramount chief dies, \r\nresulting in peacful annexation of a random set of subordinate polities\r\n\r\nDONE - if a polity has been warred against or seceded from, they can not be a target for war until the next year.\r\n\r\nwhen polities secede, they should acquire a portion of the resources of the chief polity (MAYBE)\r\n\r\nDONE - when polity id captured, if it has subordinates, they should become independant\r\n\r\nDONE - find neighbors to attack should target any polities with range of current chief and any of their subordinates\r\n\r\nDONE - BUG - nest goToWar function uses undefined target\r\n\r\n*/\r\n\r\nconst TRIBUTE_LEVEL = 0.5 // Math.random();\r\nconst LOSER_EFFECT = 0.2 // Math.random();\r\nconst CHIEF_LIFE_EXPECTANCY = 1000;\r\nconst MAX_CONTROL = 4;\r\nconst RESOURCE_BASELINE_DEVIATION = 0.2 //Math.random();\r\nconst MILITARY_DETERMINISM = 2 //getRandomIntInclusive(1, 2);\r\nconst WILLINGNESS_TO_ATTACK = 2\r\nconst RESOURCE_RECOVERY_TIME =  3 //getRandomIntInclusive(5, 15);\r\nconst GRID_SIZE = 100\r\nconst NEIGHBOR_DISTANCE = GRID_SIZE\r\n// const NEIGHBOR_DISTANCE = GRID_SIZE / 3\r\n\r\nexport const run = async (polities, steps_to_run, step_interval = 0, autoResolvePlayerDecisions) => {\r\n  for (let i = 0; i < steps_to_run; i++) {\r\n    polities\r\n    .map((polity) => {\r\n      if (polity.isPlayer && !autoResolvePlayerDecisions) chooseDecision(polity, polities);\r\n      else makeDecision(polity, polities);\r\n    });\r\n    await delay(step_interval);\r\n  }\r\n  \r\n  return polities;  \r\n}\r\n\r\nexport const generatePolities = (amount) => {\r\n  let polities = [];\r\n  for (let i = 0; i < amount; i++) {\r\n    const color = getNextColor()\r\n    polities.push(createPolity(color));\r\n  }\r\n  return polities;\r\n}\r\n\r\nconst hasChiefDied = (polity, all_polities) => {\r\n  const has_died = Math.random() <= (polity.chief_age / CHIEF_LIFE_EXPECTANCY) - 0.3\r\n  if (has_died) {\r\n    addEvent('DEATH', `${polity.name}'s Chief has died.`, [polity.id], all_polities)\r\n  }\r\n  return has_died;\r\n}\r\n\r\nconst generateChiefAge = () => getRandomIntInclusive(12, 45);\r\n\r\nconst electChief = (polity, all_polities) => {\r\n  all_polities.forEach(p => {\r\n    if (p.id === polity.id) {\r\n      p.chief_age = generateChiefAge();\r\n    }\r\n  });\r\n}\r\n\r\nconst dismantlePolity = (polity, all_polities) => {\r\n  const subordinates = getImmediateSubordinates(polity, all_polities)\r\n  const amount_to_secede = getRandomIntInclusive(0, subordinates.length);\r\n  addEvent('DISMANTLE', `${amount_to_secede} communities have decided to leave ${polity.name}.`, [polity.id], all_polities)\r\n  subordinates.map((s, i) => {\r\n    if (i <= amount_to_secede - 1) {\r\n      secede(s, all_polities);\r\n    }\r\n    return true\r\n  })\r\n}\r\n\r\nconst makeDecision = (polity, all_polities) => {\r\n  upkeep(polity, all_polities);\r\n  if (hasChiefDied(polity, all_polities)) {\r\n    dismantlePolity(polity, all_polities);\r\n    electChief(polity, all_polities);\r\n  } else {\r\n    // consider allowing all polities that have subs, make this decision\r\n    if (polity.chief === null) {\r\n      addEvent('DECISION', `The chief polity ${polity.name} deliberates`, [polity.id], all_polities)\r\n      let victim = findWeakestNeighborPolity(polity, all_polities)\r\n      if (victim && willGoToWar(polity, victim, all_polities)) {\r\n        goToWar(polity, victim, null, all_polities)\r\n      } else {\r\n        havePeace(polity, all_polities);\r\n      }\r\n    } else {\r\n      // rebelling polities rebel against immediate chief\r\n      // const chief_polity = getImmediateChief(polity, all_polities);\r\n  \r\n      // rebelling polities rebel against paramount chief\r\n      const chief_polity = getChiefPolity(polity, all_polities);\r\n      addEvent('DECISION', `${chief_polity.name}'s subordinate polity ${polity.name} deliberates`, [polity.id], all_polities)\r\n      if (willSecede(chief_polity, polity, all_polities)) {\r\n        attemptRebellion(chief_polity, polity, all_polities);\r\n      } else {\r\n        havePeace(polity, all_polities);\r\n      }\r\n    }\r\n  }\r\n\r\n  return polity;\r\n}\r\n\r\nconst chooseDecision = (polity, all_polities) => {\r\n  upkeep(polity, all_polities);\r\n  if (hasChiefDied(polity, all_polities)) {\r\n    dismantlePolity(polity, all_polities);\r\n    electChief(polity, all_polities);\r\n  } else {\r\n    informPlayer(`YOU, the leader of ${polity.name} must make a decision.`);\r\n    if (polity.chief) {\r\n      // const chief_polity = getImmediateChief(polity, all_polities);\r\n      const chief_polity = getChiefPolity(polity, all_polities);\r\n      let choose_rebellion = promptPlayer(`We are paying tribute to ${chief_polity.name}. Will you lead us in rebellion, or seek fortune on their behalf?`);\r\n      addEvent('DECISION', `${chief_polity.name}'s subordinate polity ${polity.name} deliberates`, [polity.id], all_polities)\r\n      if (choose_rebellion) {\r\n        const should_rebel = willSecede(chief_polity, polity, all_polities);\r\n        const should_rebel_advice = should_rebel ? '' : 'NOT';\r\n        choose_rebellion = promptPlayer(`We do ${should_rebel_advice} think secession is a good idea. Will you continue with the plans for WAR?`)\r\n        if (choose_rebellion) {\r\n          attemptRebellion(chief_polity, polity, all_polities);\r\n          return polity;\r\n        }\r\n      }\r\n    }\r\n    const chooses_seek_war = promptPlayer(`Will you seek WAR or have peace?`);\r\n    addEvent('DECISION', `The chief polity ${polity.name} deliberates`, [polity.id], all_polities)\r\n    if (chooses_seek_war) {\r\n      let victim = findWeakestNeighborPolity(polity, all_polities)\r\n      if (victim) {\r\n        let chooses_war = promptPlayer(`Your neigbor, ${victim.name} is weak. Will you attack or have PEACE?`);\r\n        if (chooses_war) {\r\n          const should_war = willGoToWar(polity, victim, all_polities);\r\n          const should_war_advice = should_war ? '' : 'NOT';\r\n          chooses_war = promptPlayer(`We do ${should_war_advice} think we can win. Will you continue with the plans for WAR?`)\r\n          if (chooses_war) {\r\n            goToWar(polity, victim, null, all_polities);\r\n            return polity;\r\n          }\r\n        }\r\n      } else {\r\n        informPlayer(`There are no peoples to WAR with this year.`)\r\n      }\r\n    }\r\n  }\r\n\r\n  havePeace(polity, all_polities);\r\n  return polity;\r\n}\r\n\r\nconst findWeakestNeighborPolity = (polity, all_polities) => {\r\n  let neighbor_communities = getNeighborCommunities(polity, all_polities)\r\n    .filter((c) => !immuneToViolence(c))\r\n    // .filter((c) => !c.has_incurred_secession)\r\n  \r\n  const neighbor_chiefs = \r\n    neighbor_communities\r\n    .map((p) => getChiefPolity(p, all_polities))\r\n    .sort((a, b) => getPower(a, all_polities) - getPower(b, all_polities))\r\n  \r\n  return neighbor_chiefs.length > 0 ? neighbor_chiefs[0] : false;\r\n}\r\n\r\nconst isInRange = (a, b) => {\r\n  return (\r\n    NEIGHBOR_DISTANCE >= Math.hypot(\r\n      b.coordinates.x - a.coordinates.x,\r\n      b.coordinates.y - a.coordinates.y\r\n    )\r\n  )\r\n}\r\n\r\nlet isInRangeOfChiefOrSubordinates = (chief, victim, all_polities) => {\r\n  return (\r\n    [\r\n      chief,\r\n      ...getAllSubordinates(chief, all_polities)\r\n    ].reduce((acc, curr) => acc + isInRange(victim, curr),\r\n      0\r\n    )\r\n  )\r\n}\r\n\r\nconst getNeighborCommunities = (polity, all_polities) => {\r\n  return all_polities.filter((p) => {\r\n    return (\r\n      getChiefPolity(p, all_polities).id !== polity.id\r\n      && p.id !== polity.id\r\n      && isInRangeOfChiefOrSubordinates(polity, p, all_polities)\r\n    );\r\n  });\r\n}\r\n\r\nconst findWealthiestBorderCommunity = (attacker, defender, all_polities) => {\r\n  // need to account for adjacency\r\n  let neighbor_communities = []\r\n\r\n  if (getAllSubordinates(defender, all_polities).length > 0) {\r\n    neighbor_communities =\r\n      getNeighborCommunities(attacker, all_polities)\r\n      .filter((p) => getChiefPolity(p, all_polities).id === defender.id)\r\n      .sort((a, b) => getPower(b, all_polities) - getPower(a, all_polities))\r\n  } else {\r\n    // neighbor_communities = [defender]\r\n    neighbor_communities =\r\n      getNeighborCommunities(attacker, all_polities)\r\n      .filter((p) => p.id === defender.id)\r\n  }\r\n\r\n  return neighbor_communities.length > 0 ? neighbor_communities[0] : false;\r\n}\r\n\r\nconst reorganizeInternalPolities = (chief, all_polities) => {\r\n  let annex_pairs = [];\r\n  const subordinates = getAllSubordinates(chief, all_polities)\r\n    .sort((a, b) => getPower(b, all_polities) - getPower(a, all_polities))\r\n  if (subordinates.length > MAX_CONTROL) {\r\n    subordinates.map((s, i) => {\r\n      if (i >= MAX_CONTROL) {\r\n        annex_pairs.push({ chief: subordinates[i - MAX_CONTROL], target: s})\r\n      } else {\r\n        annex_pairs.push({chief, target: s})\r\n      }\r\n      return true\r\n    })\r\n  }\r\n  annex_pairs.map((pair) => {\r\n    all_polities.forEach(p => {\r\n      if (p.id === pair.target.id) {\r\n        p.chief = pair.chief.id\r\n      }\r\n    })\r\n    return true\r\n  })\r\n}\r\n\r\nconst annexTarget = (chief, target, all_polities) => {\r\n  // addEvent('ANNEX', `${target.name} is annexed by ${chief.name}.`, [chief.id, target.id], all_polities)\r\n  const target_subordinate_ids = getImmediateSubordinates(target, all_polities).map((t) => t.id);\r\n  all_polities.forEach(p => {\r\n    if (p.id === target.id) {\r\n      p.chief = chief.id\r\n    }\r\n    // immediate subordinates of target polity should become free\r\n    if (target_subordinate_ids.indexOf(p.id) > -1) {\r\n      p.chief = null\r\n    }\r\n  });\r\n}\r\n\r\nconst secede = (polity, all_polities) => {\r\n  const chief = getChiefPolity(polity, all_polities);\r\n  all_polities.forEach(p => {\r\n    if (p.id === polity.id) {\r\n      addEvent('SECESSION', `${p.name} is seceded from ${chief.name}.`, [p.id, chief.id], all_polities)\r\n      p.chief = null;\r\n    } else if (p.id === chief.id) {\r\n      p.has_incurred_secession = true;\r\n    }\r\n  });\r\n}\r\n\r\nconst upkeep = (polity, all_polities) => {\r\n  all_polities.forEach(p => {\r\n    if (p.id === polity.id) {\r\n      p.has_incurred_secession = false;\r\n      p.has_incurred_war = false;\r\n      p.chief_age += 1;\r\n    }\r\n  });\r\n}\r\n\r\nconst willGoToWar = (polity, neighbor, all_polities) => {\r\n  const P = probabilityOfSuccessfulAttack(polity, neighbor, all_polities);\r\n  const c = costOfSuccessfulAttack(P);\r\n  return Math.random() <= probabilityPolityWillAttack(polity, P, c);\r\n}\r\n\r\nconst willSecede = (chief, subordinate, all_polities) => {\r\n  const probability_to_repel_attack = 1 - probabilityOfSuccessfulAttack(chief, subordinate, all_polities)\r\n  return Math.random() <= probability_to_repel_attack;\r\n}\r\n\r\nconst attemptRebellion = (chief, subordinate, all_polities) => {\r\n  addEvent('REBELLION', `${subordinate.name} attempts rebellion against ${chief.name}.`, [subordinate.id], all_polities);\r\n  let probability_of_successful_attack = probabilityOfSuccessfulAttack(chief, subordinate, all_polities)\r\n  let probability_to_repel_attack = 1 - probability_of_successful_attack\r\n  const rebellion_succeeds = attackRepelled(probability_to_repel_attack)\r\n  if (rebellion_succeeds) {\r\n    addEvent('REBELLION', `${subordinate.name} succeeds in rebellion against ${chief.name}.`, [subordinate.id], all_polities);\r\n    decreaseResourceBy(\r\n      costOfUnsuccessfulAttack(probability_of_successful_attack),\r\n      [\r\n        chief.id, \r\n        subordinate.id\r\n      ],\r\n      all_polities\r\n    )\r\n    secede(subordinate, all_polities);\r\n    // reorganizeInternalPolities(chief, all_polities)\r\n    reorganizeInternalPolities(getChiefPolity(chief), all_polities)\r\n  } else {\r\n    addEvent('REBELLION', `${subordinate.name} fails in rebellion against ${chief.name}.`, [subordinate.id], all_polities);\r\n    decreaseResourceBy(\r\n      costOfSuccessfulAttack(probability_of_successful_attack),\r\n      [\r\n        chief.id, \r\n        subordinate.id\r\n      ],\r\n      all_polities\r\n    )\r\n  }\r\n}\r\n\r\nconst havePeace = (polity, all_polities) => {\r\n  addEvent('PEACE', `${polity.name} has peace.`, [polity.id], all_polities);\r\n  increaseResourceBy(\r\n    Math.sign(polity.baseline_resource_level - polity.resource_level) * (polity.baseline_resource_level / RESOURCE_RECOVERY_TIME),\r\n    [polity.id],\r\n    all_polities\r\n  )\r\n}\r\n\r\nconst goToWar = (attacker, defender, probability_to_repel_attack = null, all_polities) => {\r\n  let target_community = findWealthiestBorderCommunity(attacker, defender, all_polities);\r\n  if (!target_community) {\r\n    addEvent('IMPASSE', `${defender.name} has no communities with reach of ${attacker.name}'s assualt.`, [attacker.id], all_polities);\r\n  } else {\r\n    addEvent('WAR', `${attacker.name} prepares for war against ${defender.name}`, [attacker.id], all_polities);\r\n    \r\n    let probability_of_successful_attack = probabilityOfSuccessfulAttack(attacker, target_community, all_polities)\r\n    if(probability_to_repel_attack === null) {\r\n      probability_to_repel_attack = 1 - probability_of_successful_attack\r\n    }\r\n    const attack_succeeds = !attackRepelled(probability_to_repel_attack)\r\n    if (attack_succeeds) {\r\n      addEvent('WAR', `${attacker.name} succeeds in battle against ${target_community.name}`, [attacker.id], all_polities);\r\n      decreaseResourceBy(\r\n        costOfSuccessfulAttack(probability_of_successful_attack), \r\n        [\r\n          attacker.id,\r\n          // defender.id,\r\n          target_community.id,\r\n        ], \r\n        all_polities\r\n      )\r\n      annexTarget(attacker, target_community, all_polities)\r\n      reorganizeInternalPolities(attacker, all_polities)\r\n      probability_to_repel_attack -= ((1 - LOSER_EFFECT) * probability_to_repel_attack)\r\n      // if (defender.chief !== attacker.id) {\r\n        if (getChiefPolity(defender, all_polities).id !== attacker.id) {\r\n        addEvent('WAR', `${attacker.name}'s onslaught continues against ${defender.name}`, [attacker.id], all_polities);\r\n        goToWar(attacker, defender, probability_to_repel_attack, all_polities)\r\n      }\r\n    } else {\r\n      addEvent('WAR', `${attacker.name} fails in battle against ${target_community.name}`, [attacker.id], all_polities);\r\n      decreaseResourceBy(\r\n        costOfUnsuccessfulAttack(probability_of_successful_attack),\r\n        [\r\n          attacker.id, \r\n          // defender.id,\r\n          target_community.id,\r\n        ],\r\n        all_polities\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\nconst attackRepelled = (probability_to_repel_attack) => {\r\n  return Math.random() <= probability_to_repel_attack\r\n}\r\n\r\nconst probabilityOfSuccessfulAttack = (polity, neighbor, all_polities) => {\r\n  const p1 = Math.pow(getPower(polity, all_polities), MILITARY_DETERMINISM)\r\n  const p2 = Math.pow(getPower(neighbor, all_polities), MILITARY_DETERMINISM)\r\n  const res = p1 / (p1 + p2) \r\n  return res;\r\n}\r\n\r\nconst probabilityPolityWillAttack = (polity, probability_of_successful_attack, cost_of_successful_attack) => {\r\n  let result = probability_of_successful_attack * Math.exp((-1 * WILLINGNESS_TO_ATTACK) * cost_of_successful_attack) * (polity.resource_level / polity.baseline_resource_level)\r\n  return result;\r\n}\r\n\r\nconst costOfSuccessfulAttack = (probability_of_successful_attack) => {\r\n  return RESOURCE_BASELINE_DEVIATION * (1 - probability_of_successful_attack);\r\n}\r\n\r\nconst costOfUnsuccessfulAttack = (probability_of_successful_attack) => {\r\n  return RESOURCE_BASELINE_DEVIATION * probability_of_successful_attack;\r\n}\r\n\r\nconst decreaseResourceBy = (value, ids, all_polities) => {\r\n  all_polities.forEach(p => {\r\n    if (ids.indexOf(p.id) > -1) {\r\n      p.resource_level = Math.max(0, p.resource_level - value)\r\n    }\r\n  });\r\n}\r\n\r\nconst increaseResourceBy = (value, ids, all_polities) => {\r\n  all_polities.forEach(p => {\r\n    if (ids.indexOf(p.id) > -1) {\r\n      p.resource_level += value\r\n    }\r\n  });\r\n}\r\n\r\nexport const getPower = (polity, all_polities) => {\r\n  const subordinates = getImmediateSubordinates(polity, all_polities)\r\n  let res = subordinates.reduce(\r\n      (acc, curr) => {\r\n        return acc + (curr.resource_level * TRIBUTE_LEVEL)\r\n      }, 0)\r\n  return res + polity.resource_level\r\n}\r\n\r\nexport const getTotalPower = (polities, all_polities) => {\r\n  return polities.reduce(\r\n    (acc, curr) => {\r\n      return acc + getPower(curr, all_polities)\r\n    }, 0)\r\n}\r\n\r\nexport const getAllSubordinates = (polity, all_polities) => {\r\n  return all_polities.filter((p) => (p.id !== polity.id) && (getChiefPolity(p, all_polities).id === polity.id));\r\n}\r\n\r\nexport const getImmediateSubordinates = (polity, all_polities) => {\r\n  return all_polities.filter((p) => (p.id !== polity.id) && (p.chief === polity.id));\r\n}\r\n\r\nexport const getChiefPolity = (polity, all_polities) => {\r\n  let chief_polity = false;\r\n  let result = [];\r\n  \r\n  if (polity.chief !== null) {\r\n    result = all_polities.filter((p) => {\r\n      return (p.id === polity.chief)\r\n    });\r\n  }\r\n\r\n\r\n  if (result.length > 0) {\r\n    chief_polity = result[0];\r\n  }\r\n    \r\n  if (chief_polity) {\r\n    return getChiefPolity(chief_polity, all_polities);\r\n  } else {\r\n    return polity;\r\n  }\r\n\r\n}\r\n\r\nconst getImmediateChief = (polity, all_polities) => {\r\n  const result = all_polities.filter((p) => polity.chief === p.id);\r\n  return result.length > 0 ? result[0] : false;\r\n}\r\n\r\nconst createEvent = (type = 'DEFAULT', message = '') => {\r\n  const event = EVENT_TYPES[type]; \r\n  return { event, message }\r\n}\r\n\r\nconst addEvent = (type, message, ids, all_polities) => {\r\n  all_polities.forEach(p => {\r\n    if (ids.indexOf(p.id) > -1) {\r\n      p.events = p.events.concat(createEvent(type, message))\r\n    }\r\n  });\r\n}\r\n\r\nconst promptPlayer = (message, label_yes, label_no) => {\r\n  window.confirm(message)\r\n}\r\n\r\nconst informPlayer = (message) => {\r\n  window.alert(message);\r\n}\r\n\r\nexport const EVENT_TYPES = {\r\n  DEFAULT: {\r\n    color: 'gray',\r\n  },\r\n  DECISION: {\r\n    color: 'green',\r\n  },\r\n  WAR: {\r\n    color: 'red',\r\n  },\r\n  PEACE: {\r\n    color: 'blue',\r\n  },\r\n  SECESSION: {\r\n    color: 'yellow',\r\n  },\r\n  ANNEX: {\r\n    color: 'orange',\r\n  },\r\n  DEATH: {\r\n    color: 'purple',\r\n  },\r\n  DISMANTLE: {\r\n    color: 'gray',\r\n  },\r\n  IMPASSE: {\r\n    color: 'gray',\r\n  },\r\n}\r\n\r\nexport const getPolityPercentages = (polities) => {\r\n  const total_communities = polities.length;\r\n  return polities.map((p) => {\r\n    let percent = (getAllSubordinates(p, polities).length) / total_communities\r\n    return { percent, polity_id: p.id }\r\n  })\r\n}\r\n\r\nexport const getEvents = (polities) => {\r\n  return polities.map((p) => {\r\n    return {events: [...p.events], polity_id: p.id}\r\n  })\r\n}\r\n\r\nexport const getPowerPercentages = (polities) => {\r\n  const total_power = getTotalPower(polities, polities)\r\n  return polities.map((p) => {\r\n    let percent = (getPower(p, polities) / total_power)\r\n    return { percent, polity_id: p.id }\r\n  })\r\n}\r\n\r\nexport function createPolity(color) {\r\n  const baseline_resource_level = 1 + (getRandomIntInclusive(-1, 1) * RESOURCE_BASELINE_DEVIATION)\r\n\r\n  let polity = {\r\n    id: uuid(),\r\n    name: composeName([namePrefixes, nameSuffixes]),\r\n    baseline_resource_level,\r\n    resource_level: baseline_resource_level,\r\n    chief: null,\r\n    coordinates: {\r\n      x: getRandomIntInclusive(0, GRID_SIZE),\r\n      y: getRandomIntInclusive(0, GRID_SIZE)\r\n    },\r\n    has_incurred_secession: false,\r\n    has_incurred_war: false,\r\n    chief_age: 30,\r\n    events: [],\r\n    isPlayer: false,\r\n    // color: Konva.Util.getRandomColor(),\r\n    color,\r\n  }\r\n  return polity;\r\n}\r\n\r\nexport const createPlayerPolity = (color) => { return {...createPolity(color), isPlayer: true} };\r\n\r\nconst immuneToViolence = (polity) => polity.has_incurred_secession && polity.has_incurred_war;\r\n\r\nconst namePrefixes = [\r\n  'Moon',\r\n  'Sun',\r\n  'Black',\r\n  'White',\r\n  'Light',\r\n  'Shadow',\r\n  'Red',\r\n  'Green',\r\n  'Gray',\r\n  'Mighty',\r\n  'Wither',\r\n  'Gale',\r\n  'Hay',\r\n  'Stone',\r\n  'River',\r\n]\r\n\r\nconst nameSuffixes = [\r\n  'Fire',\r\n  'Water',\r\n  'Belly',\r\n  'Peaks',\r\n  'Born',\r\n  'Still',\r\n  'Wood',\r\n  'Wine',\r\n  'Run',\r\n  'Guard',\r\n  'Fell',\r\n  'Fall',\r\n]\r\n\r\nconst composeName = (namePartLists = []) => {\r\n  return namePartLists.map((list) => getRandomInArray(list)).join(' ')\r\n}\r\n\r\nconst COLORS = {\r\n  background: '#eadcbd',\r\n  entity: [\r\n    '#de6640',\r\n    '#e39d96',\r\n    '#e8c4ac',\r\n    '#ebd66b',\r\n    '#638c5f',\r\n    '#869f9b',\r\n    '#cac9b4',\r\n  ],\r\n}\r\n\r\nlet CURRENT_COLOR_INDEX = 0\r\nconst getNextColor = () => {\r\n  const color = COLORS.entity[CURRENT_COLOR_INDEX % COLORS.entity.length]\r\n  CURRENT_COLOR_INDEX += 1\r\n  return color\r\n}","import React from 'react';\r\nimport '../App.css';\r\nimport * as Cycling from '../lib/turchin_cycling';\r\nimport { Rect, Text, Line, Group } from 'react-konva';\r\n\r\nclass NodeView extends React.Component {\r\n  constructor (props) {\r\n    super(props);\r\n    this.state = {\r\n      offset_x: (props.width / 100) - 1,\r\n      offset_y: (props.height / 100) - 1,\r\n      base_size: 10,\r\n      size_multiplier: 20,\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const polities = this.props.polities.map((p, i) => {\r\n      const chief_pos_x = p.coordinates.x * this.state.offset_x\r\n      const chief_pos_y = p.coordinates.y * this.state.offset_y\r\n      const power = Cycling.getPower(p, this.props.polities)\r\n      const size = (this.state.size_multiplier * power) + this.state.base_size\r\n      const subordinate_lines = Cycling.getImmediateSubordinates(p, this.props.polities).map((subordinate, i) => {\r\n        return (\r\n          <Group>\r\n            <Line\r\n              key={i + 'b'}\r\n              x={0}\r\n              y={0}\r\n              points={[\r\n                chief_pos_x,\r\n                chief_pos_y,\r\n                // chief_pos_x + 20, \r\n                // chief_pos_y + 20, \r\n                subordinate.coordinates.x * this.state.offset_x,\r\n                subordinate.coordinates.y * this.state.offset_y\r\n              ]}\r\n              stroke={Cycling.getChiefPolity(p, this.props.polities).color}\r\n              // stroke={p.color}\r\n              tension={1}\r\n              strokeWidth={4}\r\n            />\r\n          </Group>\r\n        )\r\n      })\r\n      return (\r\n        <Group key={i}>\r\n          <Text\r\n            x={chief_pos_x}\r\n            y={chief_pos_y + 40}\r\n            text={p.name}\r\n            fill='red'\r\n            fontSize={20}\r\n          />\r\n          <Text\r\n            x={chief_pos_x}\r\n            y={chief_pos_y - 20}\r\n            text={Math.round(power * 100) / 100}\r\n            fill='red'\r\n            fontSize={20}\r\n          />\r\n          <Rect\r\n            x={chief_pos_x}\r\n            y={chief_pos_y}\r\n            width={size}\r\n            height={size}\r\n            fill={p.color}\r\n            shadowBlur={5}\r\n          />\r\n          {subordinate_lines}\r\n        </Group>\r\n      )\r\n    })\r\n    return (\r\n      <Group>\r\n        {polities}\r\n      </Group>\r\n    );\r\n  }\r\n}\r\n\r\nexport default NodeView;\r\n","const createTheme = (background = '#282c34', element_body = '#eadcbd', element_text = '#282c34', chart_lines = '#eadcbd') => {\r\n  return {\r\n    background,\r\n    element_body,\r\n    element_text,\r\n    chart_lines,\r\n  }\r\n}\r\n\r\nexport const themes = {\r\n  dark: createTheme(),\r\n  light: createTheme('#eadcbd', '#282c34', '#eadcbd', '#282c34'),\r\n}","import React from 'react';\r\nimport '../App.css';\r\nimport * as Cycling from '../lib/turchin_cycling';\r\nimport { Text, Line, Group, Rect } from 'react-konva';\r\nimport * as Styles from '../styles';\r\n\r\nconst getStepPercentageByPolity = (step, polity) => {\r\n  const found_polity = step.percents.filter((per) => per.polity_id === polity.id)[0]\r\n  return !!found_polity \r\n    ? found_polity.percent \r\n    : 0\r\n}\r\n\r\nclass ChartView extends React.Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      // step_distance: 30,\r\n      step_distance: 100,\r\n      entity_distance: 40,\r\n      offset_x: props.offset_x,\r\n      offset_y: props.offset_y,\r\n      previous_polity_power: 0,\r\n      padding_right: props.offset_x,\r\n      event_text_width: 60,\r\n    }\r\n  }\r\n\r\n  render() {\r\n    let lines = this.props.all_historical_polities.map((p) => {\r\n      return {\r\n        polity: p,\r\n        points: [],\r\n      }\r\n    });\r\n\r\n    this.props.history.map((step, i) => {\r\n      step.polities.map((polity, j) => {\r\n        const all_previous_percents = j > 0\r\n          ? step.percents\r\n            .slice(0, j)\r\n            .reduce((acc, curr) => acc + curr.percent, 0)\r\n          : 0\r\n        const percentage = getStepPercentageByPolity(step, polity)\r\n        const x = ((this.props.width - this.state.offset_x) * (percentage + all_previous_percents))\r\n        const y = i * this.state.step_distance\r\n\r\n        lines = lines.map((line) => {\r\n          if (line.polity.id === polity.id) {\r\n            line.points = [...line.points, x, y]\r\n          }\r\n          return line\r\n        })\r\n        return true\r\n      })\r\n      return true\r\n    })\r\n\r\n    let chart_pos_x = this.state.offset_x;\r\n    let chart_pos_y = this.state.offset_y;\r\n    let chart_height = this.props.history.length * this.state.step_distance;\r\n\r\n    if (chart_height >= (this.props.height - this.state.offset_y)) {\r\n      chart_pos_y = (this.state.offset_y - chart_height) + (this.props.height - this.state.step_distance);\r\n    }\r\n\r\n    return (\r\n      <Group>\r\n        {/* <Group\r\n          draggable={true}\r\n          dragBoundFunc={\r\n            (pos) => {\r\n              return {\r\n                x: 0,\r\n                y: Math.min(0, pos.y)\r\n              }\r\n            }\r\n          }\r\n        >\r\n          {\r\n            this.props.polities.map((p, i) => {\r\n              return (\r\n                <Group key={i}>\r\n                  <Text\r\n                    x={20}\r\n                    y={100 + (i * 50)}\r\n                    text={p.name}\r\n                    fill={p.color}\r\n                    fontSize={20}\r\n                    />\r\n                  <Text\r\n                    x={20}\r\n                    y={120 + (i * 50)}\r\n                    text={Math.round(Cycling.getPower(p, this.props.polities) * 100) / 100}\r\n                    fill={p.color}\r\n                    fontSize={20}\r\n                  />\r\n                </Group>\r\n              )\r\n            })\r\n          }\r\n        </Group> */}\r\n        <Group \r\n          x={chart_pos_x} \r\n          y={chart_pos_y}\r\n          draggable={true}\r\n          dragBoundFunc={\r\n            (pos) => {\r\n              return {\r\n                x: this.state.offset_x,\r\n                y: Math.min(this.state.offset_y, pos.y)\r\n              }\r\n            }\r\n          }\r\n        >\r\n          {\r\n            lines.map((line, k) => {\r\n              let extra_points = [];\r\n                this.props.history.forEach((step, l) => {\r\n                  if (l === this.props.history.length - 1) {\r\n                    extra_points = extra_points.concat([0, l * this.state.step_distance])\r\n                    extra_points = extra_points.concat([0, 0])\r\n                  }\r\n                })\r\n              return (\r\n                <Line\r\n                  key={k}\r\n                  x={0}\r\n                  y={0}\r\n                  points={line.points.concat(extra_points)}\r\n                  // stroke={line.polity.color}\r\n                  stroke={Styles.themes[this.props.theme].background}\r\n                  // stroke={'#eadcbd'}\r\n                  // stroke={'#282C34'}\r\n                  tension={0}\r\n                  // bezier={true}\r\n                  strokeWidth={4}\r\n                  closed={true}\r\n                  fill={line.polity.color}\r\n                />\r\n              )\r\n            }).reverse()\r\n          }\r\n          {\r\n            this.props.history.map((step, i) => {\r\n              return (\r\n                <Group>\r\n                  <Text\r\n                    x={(this.props.side_info_width - this.state.offset_x)}\r\n                    y={(i * this.state.step_distance) - 25}\r\n                    width={this.props.side_info_width}\r\n                    text={`${i * this.props.years_to_run}`}\r\n                    fill={Styles.themes[this.props.theme].element_body}\r\n                    fontSize={20}\r\n                    fontStyle={'bold'}\r\n                    align={'center'}\r\n                  />\r\n                  <Line\r\n                    key={i}\r\n                    x={0}\r\n                    y={0}\r\n                    points={[\r\n                      this.props.side_info_width - this.state.offset_x, i * this.state.step_distance,\r\n                      (this.props.width - this.state.offset_x + this.props.side_info_width), i * this.state.step_distance\r\n                    ]}\r\n                    stroke={Styles.themes[this.props.theme].chart_lines}\r\n                    tension={0}\r\n                    strokeWidth={2}\r\n                  />\r\n                  <Text\r\n                    x={(this.props.width - this.state.offset_x)}\r\n                    // x={(this.props.side_info_width - this.state.offset_x)}\r\n                    y={(i * this.state.step_distance) - 25}\r\n                    width={this.props.side_info_width}\r\n                    text={`${i * this.props.years_to_run}`}\r\n                    fill={Styles.themes[this.props.theme].element_body}\r\n                    fontSize={20}\r\n                    fontStyle={'bold'}\r\n                    align={'center'}\r\n                  />\r\n                </Group>\r\n              )\r\n            })\r\n          }\r\n          {\r\n            this.props.history.map((step, i) => {\r\n              \r\n              return step.polities.map((polity, j) => {\r\n                const all_previous_percents = j > 0\r\n                  ? step.percents.slice(0, j).reduce((acc, curr) => acc + curr.percent, 0)\r\n                  : 0\r\n                const percentage = getStepPercentageByPolity(step, polity)\r\n                const x_end = ((this.props.width - this.state.offset_x) * (percentage + all_previous_percents))\r\n                const x_begin = ((this.props.width - this.state.offset_x) * (all_previous_percents))\r\n                const x = x_begin + ((x_end - x_begin - (this.state.event_text_width / 2)) / 2);\r\n                const text_padding = 16;\r\n                const polity_events = step.events.filter((e) => e.polity_id === polity.id);\r\n                const event_log = polity_events.length > 0 ? polity_events[0].events : []\r\n                if (percentage > 0.08) {\r\n                  return (\r\n                    <Group key={j}>\r\n                      <Text\r\n                        x={x_begin + text_padding}\r\n                        // x={x}\r\n                        y={((i * this.state.step_distance) - (this.state.step_distance / 2))}\r\n                        // y={((i * this.state.step_distance))}\r\n                        width={x_end - x_begin - text_padding}\r\n                        // width={this.state.event_text_width + 10}\r\n                        text={\r\n                          `${polity.name.toUpperCase()}\\n${event_log.length > 0 ? event_log[event_log.length - 1].message : 'none'}`\r\n                        }\r\n                        // fill={'black'}\r\n                        fill={Styles.themes['light'].element_body}\r\n                        fontSize={12}\r\n                        fontStyle={'bold'}\r\n                        align={'center'}\r\n                      />\r\n                    </Group>\r\n                  )\r\n                }\r\n              })\r\n            })\r\n          }\r\n        </Group>\r\n        {/* <Rect\r\n          x={this.props.side_info_width}\r\n          y={0}\r\n          width={this.props.width}\r\n          height={this.props.height}\r\n          stroke={Styles.themes[this.props.theme].element_body}\r\n          strokeWidth={4}\r\n        // fill={Styles.themes[this.props.theme].element_body}\r\n        // onClick={() => this.step()}\r\n        /> */}\r\n      </Group>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ChartView;\r\n","import React from 'react';\r\nimport '../../App.css';\r\nimport * as Styles from '../../styles';\r\n\r\nfunction Toolbar(props) {\r\n\r\n  const handleStartPause = () => {\r\n    if (props.running_sim) {\r\n      props.onPause()\r\n    } else {\r\n      props.onStart()\r\n    }\r\n  }\r\n\r\n  const downloadURI = (uri, name) => {\r\n    let link = document.createElement('a');\r\n    link.download = name;\r\n    link.href = uri;\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n    // delete link;\r\n  }\r\n\r\n  return (\r\n    <div className=\"Toolbar\">\r\n      <button\r\n        onClick={handleStartPause}\r\n        className=\"btn\"\r\n        title=\"\r\n          Start/Stop History\r\n          (player politiy decisions will be auto resolved)\r\n        \"\r\n        style={{\r\n          backgroundColor: Styles.themes[props.theme].element_body,\r\n          color: Styles.themes[props.theme].element_text\r\n        }}\r\n      >\r\n        {\r\n          props.running_sim\r\n            ? 'Pause'\r\n            : 'Auto'\r\n        }\r\n      </button>\r\n      <button\r\n        onClick={() => props.onStep()}\r\n        className=\"btn\"\r\n        style={{\r\n          backgroundColor: Styles.themes[props.theme].element_body,\r\n          color: Styles.themes[props.theme].element_text\r\n        }}\r\n      >\r\n        Step\r\n      </button>\r\n      <button\r\n        onClick={() => props.onRestart()}\r\n        className=\"btn\"\r\n        style={{\r\n          backgroundColor: Styles.themes[props.theme].element_body,\r\n          color: Styles.themes[props.theme].element_text\r\n        }}\r\n      >\r\n        Restart\r\n      </button>\r\n      <button\r\n        onClick={() => props.onReset()}\r\n        className=\"btn\"\r\n        style={{\r\n          backgroundColor: Styles.themes[props.theme].element_body,\r\n          color: Styles.themes[props.theme].element_text\r\n        }}\r\n      >\r\n        New History\r\n      </button>\r\n      <button\r\n        onClick={() => props.onAddTurchinPolity()}\r\n        className=\"btn\"\r\n        style={{\r\n          backgroundColor: Styles.themes[props.theme].element_body,\r\n          color: Styles.themes[props.theme].element_text\r\n        }}\r\n      >\r\n        Add Polity\r\n      </button>\r\n      <button\r\n        onClick={() => props.onAddPlayerPolity()}\r\n        className=\"btn\"\r\n        style={{\r\n          backgroundColor: Styles.themes[props.theme].element_body,\r\n          color: Styles.themes[props.theme].element_text\r\n        }}\r\n      >\r\n        Add Player\r\n      </button>\r\n      <button\r\n        onClick={() => props.onSwitchTheme()}\r\n        className=\"btn\"\r\n        style={{\r\n          backgroundColor: Styles.themes[props.theme].element_body,\r\n          color: Styles.themes[props.theme].element_text\r\n        }}\r\n      >\r\n        {\r\n          props.theme === 'light' \r\n            ? 'Go Dark' \r\n            : 'Go Light'\r\n        }\r\n      </button>\r\n      <button\r\n        onClick={() => props.onSwitchView()}\r\n        className=\"btn\"\r\n        style={{\r\n          backgroundColor: Styles.themes[props.theme].element_body,\r\n          color: Styles.themes[props.theme].element_text\r\n        }}\r\n      >\r\n        {\r\n          props.chart_view\r\n            ? 'Node View' \r\n            : 'Chart View'\r\n        }\r\n      </button>\r\n      {/* <button\r\n        onClick={() => {\r\n            let dataURL = props.stage_ref.current.toDataURL()\r\n            downloadURI(dataURL, 'the_histomap.png');\r\n          // console.log(props.stage_ref.current);\r\n            \r\n          }\r\n        }\r\n        className=\"btn\"\r\n        style={{\r\n          backgroundColor: Styles.themes[props.theme].element_body,\r\n          color: Styles.themes[props.theme].element_text\r\n        }}\r\n      >\r\n        Print\r\n      </button> */}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Toolbar;","import React from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport Drawer from '@material-ui/core/Drawer';\r\nimport Button from '@material-ui/core/Button';\r\nimport List from '@material-ui/core/List';\r\nimport Divider from '@material-ui/core/Divider';\r\nimport ListItem from '@material-ui/core/ListItem';\r\nimport ListItemText from '@material-ui/core/ListItemText';\r\nimport InboxIcon from '@material-ui/icons/MoveToInbox';\r\nimport MailIcon from '@material-ui/icons/Mail';\r\nimport MenuIcon from '@material-ui/icons/Menu';\r\nimport * as Styles from '../../styles';\r\n\r\nconst useStyles = makeStyles({\r\n  list: {\r\n    width: 500,\r\n  },\r\n  fullList: {\r\n    width: 'auto',\r\n  },\r\n});\r\n\r\nexport default function TemporaryDrawer(props) {\r\n  const classes = useStyles();\r\n  const [state, setState] = React.useState({\r\n    top: false,\r\n    left: false,\r\n    bottom: false,\r\n    right: false,\r\n  });\r\n\r\n  const toggleDrawer = (side, open) => event => {\r\n    if (event.type === 'keydown' && (event.key === 'Tab' || event.key === 'Shift')) {\r\n      return;\r\n    }\r\n\r\n    setState({ ...state, [side]: open });\r\n  };\r\n\r\n  const ListItemLink = (props) => {\r\n    return <ListItem button style={{ color: '#de6640'}} component=\"a\" {...props} />;\r\n  }\r\n\r\n  const sideList = side => (\r\n    <div\r\n      className={classes.list}\r\n      role=\"presentation\"\r\n      onClick={toggleDrawer(side, false)}\r\n      onKeyDown={toggleDrawer(side, false)}\r\n    >\r\n      <List>\r\n        <ListItem>\r\n          <h4>About</h4>\r\n        </ListItem>\r\n        <ListItem>\r\n          <ListItemText>\r\n            This is intended generate histomaps similar to John B. Sparks 1931 piece, titled â€œThe Histomap: Four Thousand Years of World History.â€\r\n          </ListItemText>\r\n        </ListItem>\r\n        <ListItem>\r\n          <ListItemText>\r\n            To simulate an early history I interpret Peter Turchin's model for Cycling in the Complexity of Early Societies.\r\n          </ListItemText>\r\n        </ListItem>\r\n      </List>\r\n      <Divider />\r\n      <List>\r\n        <ListItemLink href=\"https://www.worldhistorycharts.com/the-histomap-by-john-sparks/\">\r\n          <ListItemText primary=\"The Histomap by John B. Sparks\" />\r\n        </ListItemLink>\r\n        <ListItemLink href=\"https://escholarship.org/uc/item/5536t55r#page-1\">\r\n          <ListItemText primary=\"Cycling in the Complexity of Early Societies by Peter Turchin\" />\r\n        </ListItemLink>\r\n      </List>\r\n      <Divider />\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div>\r\n      <Button\r\n        disableFocusRipple={true}\r\n        className=\"btn\" \r\n        style={{\r\n          position: 'absolute',\r\n          borderRadius: 2,\r\n          left: 10,\r\n          top: 10,\r\n          backgroundColor: Styles.themes[props.theme].element_body,\r\n          color: Styles.themes[props.theme].element_text\r\n        }}\r\n        onClick={toggleDrawer('left', true)}\r\n      >\r\n        <MenuIcon />\r\n      </Button>\r\n      <Drawer\r\n        PaperProps={{\r\n          style: {\r\n            backgroundColor: Styles.themes[props.theme].element_body,\r\n            color: Styles.themes[props.theme].element_text\r\n          }\r\n        }}\r\n        open={state.left} \r\n        onClose={toggleDrawer('left', false)}\r\n      >\r\n        {sideList('left')}\r\n      </Drawer>\r\n    </div>\r\n  );\r\n}","import React from 'react';\r\nimport './App.css';\r\nimport * as Cycling from './lib/turchin_cycling';\r\nimport NodeView from './histomap/NodeView';\r\nimport ChartView from './histomap/ChartView';\r\nimport Toolbar from './histomap/components/Toolbar';\r\nimport Sidenav from './histomap/components/Sidenav';\r\nimport { Stage, Layer, Rect, Text } from 'react-konva';\r\nimport * as Styles from './styles';\r\nimport { delay } from \"q\";\r\n\r\nclass Histomap extends React.Component {\r\n  constructor() {\r\n    super();\r\n    const polities = Cycling.generatePolities(10);\r\n    // polities.push(Cycling.createPlayerPolity('white'));\r\n    const percents = Cycling.getPowerPercentages(polities);\r\n    // const percents = Cycling.getPolityPercentages(polities);\r\n    const events = [];\r\n    const chart_padding = 180;\r\n    const side_info_width = 80;\r\n    const top_section_height = 200;\r\n    const bottom_section_height = 60;\r\n    const stage_padding_top = 20;\r\n\r\n    this.state = {\r\n      polities: polities,\r\n      all_historical_polities: polities,\r\n      chart_padding,\r\n      side_info_width,\r\n      width: window.innerWidth - chart_padding,\r\n      // height: window.innerHeight - (top_section_height + stage_padding_top),\r\n      height: window.innerHeight - (top_section_height + bottom_section_height + stage_padding_top),\r\n      stage_padding_top,\r\n      top_section_height,\r\n      bottom_section_height,\r\n      history: [{polities, percents, events}],\r\n      years_to_run: 1,\r\n      running_sim: false,\r\n      running_sim_reference: null,\r\n      step_interval: 500,\r\n      chart_view: true,\r\n    }\r\n    this.stage_ref = React.createRef();\r\n  }\r\n\r\n  async componentDidMount () {\r\n    // let polities = [...this.state.polities];\r\n    console.table(this.state.polities);\r\n    // polities = await Cycling.run(polities, 300, 0);\r\n    // this.setState({polities});\r\n    // // console.table(this.state.polities);\r\n    // for (let i = 0; i < 10; i ++) {\r\n    //   await this.step(this.state.years_to_run, (this.state.step_interval / this.state.years_to_run));\r\n    // }\r\n    // while (this.state.running_sim_reference !== null) {\r\n    //   await this.step(this.state.years_to_run, (this.state.step_interval / this.state.years_to_run));\r\n    // }\r\n  }\r\n\r\n  async start () {\r\n    await this.setState({running_sim: true})\r\n    await this.continuousStep(this.state.years_to_run, (this.state.step_interval / this.state.years_to_run));\r\n  }\r\n  \r\n  pause () {\r\n    this.setState({running_sim: false})\r\n  }\r\n\r\n  onSwitchView () {\r\n    this.setState({chart_view: !this.state.chart_view})\r\n  }\r\n\r\n  async continuousStep (years_to_run = 1, step_interval = 0) {\r\n    const autoResolvePlayerDecisions = true\r\n    let polities = await Cycling.run([...this.state.polities], years_to_run, step_interval, autoResolvePlayerDecisions);\r\n    // testing out when a polity is removed\r\n    // let random_index = getRandomIntInclusive(0, polities.length);\r\n    // polities = polities.filter((p, i) => i !== random_index)\r\n\r\n    const percents = Cycling.getPowerPercentages(polities);\r\n    // const percents = Cycling.getPolityPercentages(polities);\r\n    const events = Cycling.getEvents(polities);\r\n\r\n    const history = this.state.history.concat({polities, percents, events});\r\n    \r\n    await this.setState({ polities, history });\r\n\r\n    await delay(this.state.step_interval);\r\n    if (this.state.running_sim) {\r\n      await this.continuousStep(years_to_run, (step_interval / years_to_run));\r\n    }\r\n  }\r\n\r\n  async step (years_to_run = 1, step_interval = 0) {\r\n    let polities = await Cycling.run([...this.state.polities], years_to_run, step_interval);\r\n    // testing out when a polity is removed\r\n    // let random_index = getRandomIntInclusive(0, polities.length);\r\n    // polities = polities.filter((p, i) => i !== random_index)\r\n\r\n    const percents = Cycling.getPowerPercentages(polities);\r\n    // const percents = Cycling.getPolityPercentages(polities);\r\n    const events = Cycling.getEvents(polities);\r\n\r\n    const history = this.state.history.concat({polities, percents, events});\r\n    \r\n    await this.setState({ polities, history });\r\n    // console.table(polities);\r\n  }\r\n\r\n  reset () {\r\n    const polities = Cycling.generatePolities(20);\r\n    const percents = Cycling.getPowerPercentages(polities);\r\n    // const percents = Cycling.getPolityPercentages(polities);\r\n    const events = [];\r\n    const history = [{ polities, percents, events }];\r\n\r\n    this.setState({\r\n      polities,\r\n      all_historical_polities: polities,\r\n      history,\r\n    });\r\n  }\r\n\r\n  restart () {\r\n    const polities = this.state.all_historical_polities;\r\n    const percents = Cycling.getPowerPercentages(polities);\r\n    // const percents = Cycling.getPolityPercentages(polities);\r\n    const events = [];\r\n    const history = [{ polities, percents, events }];\r\n\r\n    this.setState({\r\n      polities,\r\n      history,\r\n    });\r\n  }\r\n\r\n  addPolity (new_polity) {\r\n    const polities = this.state.polities.concat(new_polity)\r\n    const percents = Cycling.getPowerPercentages(polities);\r\n    const history = this.state.history.concat({ polities, percents, events: [] });\r\n    this.setState({polities, history})\r\n  }\r\n\r\n  addTurchinPolity () {\r\n    const new_polity = Cycling.generatePolities(1)[0]\r\n    this.addPolity(new_polity)\r\n  }\r\n\r\n  addPlayerPolity () {\r\n    const new_polity = Cycling.createPlayerPolity('white')\r\n    this.addPolity(new_polity)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div>\r\n        <Sidenav theme={this.props.theme} />\r\n        <div className='top-section' style={{height: this.state.top_section_height}}>\r\n          <h1 style={{color: Styles.themes[this.props.theme].element_body, margin: 0}}>The HISTOMAP</h1>\r\n          <p style={{ color: Styles.themes[this.props.theme].element_body}}>\r\n            {`${(this.state.history.length - 1) * this.state.years_to_run} year${this.state.history.length > 1 ? 's' : ''} of world history`.toUpperCase()}\r\n          </p>\r\n          <p style={{ color: Styles.themes[this.props.theme].element_body}}>{`Relative power of contemporary states, nations, and empires`.toUpperCase()}</p>\r\n          <Toolbar \r\n            theme={this.props.theme}\r\n            running_sim={this.state.running_sim}\r\n            onStart={this.start.bind(this)}\r\n            onPause={this.pause.bind(this)}\r\n            onStep={this.step.bind(this)}\r\n            onReset={this.reset.bind(this)}\r\n            onRestart={this.restart.bind(this)}\r\n            onSwitchTheme={this.props.onSwitchTheme}\r\n            onSwitchView={this.onSwitchView.bind(this)}\r\n            onAddTurchinPolity={this.addTurchinPolity.bind(this)}\r\n            onAddPlayerPolity={this.addPlayerPolity.bind(this)}\r\n            chart_view={this.state.chart_view}\r\n            stage_ref={this.stage_ref}\r\n          />\r\n        </div>\r\n        <div className='Stage' style={{ paddingTop: this.state.stage_padding_top }}>\r\n          <Stage ref={this.stage_ref} width={this.state.width} height={this.state.height}>\r\n            <Layer>\r\n              {\r\n                this.state.chart_view && (\r\n                  <ChartView\r\n                    theme={this.props.theme}\r\n                    polities={this.state.polities}\r\n                    all_historical_polities={this.state.polities}\r\n                    // all_historical_polities={this.state.all_historical_polities}\r\n                    history={this.state.history}\r\n                    years_to_run={this.state.years_to_run}\r\n                    side_info_width={this.state.side_info_width}\r\n                    width={this.state.width - this.state.side_info_width}\r\n                    height={this.state.height - this.state.stage_padding_top}\r\n                    offset_x={this.state.chart_padding}\r\n                    // offset_x={0}\r\n                    offset_y={85}\r\n                  />\r\n                )\r\n              }\r\n              {\r\n                !this.state.chart_view && (\r\n                  <NodeView\r\n                    polities={this.state.polities}\r\n                    width={this.state.width}\r\n                    height={this.state.height}\r\n                  />\r\n                )\r\n              }\r\n              \r\n            </Layer>\r\n          </Stage>\r\n        </div>\r\n        <div className='bottom-section' style={{ height: this.state.bottom_section_height }}>\r\n          <span style={{ color: Styles.themes[this.props.theme].element_body}} className='bottom-section-text'>Copyright by David A. Vanderhaar</span>\r\n          <span style={{ color: Styles.themes[this.props.theme].element_body}} className='bottom-section-text'>Made with React and Konva</span>\r\n          <span style={{ color: Styles.themes[this.props.theme].element_body}} className='bottom-section-text'>Model based on Peter Turchin's Cycling in the Complexity of Early Societies</span>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Histomap;\r\n","import React, { useState } from 'react';\r\nimport './App.css';\r\nimport Histomap from './Histomap';\r\nimport * as Styles from './styles';\r\nimport Pdf from \"react-to-pdf\";\r\n\r\nconst switchTheme = (theme) => {\r\n  if (theme === 'light') {\r\n    return 'dark';\r\n  } else {\r\n    return 'light';\r\n  }\r\n}\r\n\r\nconst ref = React.createRef();\r\n\r\nfunction App() {\r\n  const [theme, setTheme] = useState('light');\r\n  return (\r\n    <div ref={ref} className=\"App\" style={{\r\n      backgroundColor: Styles.themes[theme].background,\r\n      // border: `solid ${Styles.themes[theme].element_body} 4px`,\r\n      // margin: '50px',\r\n    }}>\r\n      {/* <Pdf targetRef={ref} filename=\"code-example.pdf\">\r\n        {({ toPdf }) => <button onClick={toPdf}>Generate Pdf</button>}\r\n      </Pdf> */}\r\n      <Histomap onSwitchTheme={() => { setTheme(switchTheme(theme))}} theme={theme}/>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}