(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{19:function(t,e,n){},41:function(t,e,n){t.exports=n(98)},45:function(t,e,n){},46:function(t,e,n){t.exports=n.p+"static/media/logo.43f13564.svg"},98:function(t,e,n){"use strict";n.r(e);var i=n(3),r=n.n(i),a=n(38),o=n.n(a),c=(n(45),n(46),n(19),n(9)),s=n(8),u=n.n(s),l=n(17),f=n(11),h=n(12),d=n(14),p=n(13),m=n(15);function v(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}var _=n(39),g=n.n(_),y=n(40),E=n(25),x=n.n(E),w=.2,b=100,O=b,k=function(){var t=Object(l.a)(u.a.mark(function t(e,n){var i,r,a=arguments;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=a.length>2&&void 0!==a[2]?a[2]:0,r=0;case 2:if(!(r<n)){t.next=10;break}return console.log("%cTIME_STEP: ".concat(r),"color: yellow; font-style: italic; background-color: blue;padding: 2px"),e.map(function(t){return j(t,e)}),t.next=7,Object(y.delay)(i);case 7:r++,t.next=2;break;case 10:return t.abrupt("return",e);case 11:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}(),S=function(t){for(var e=[],n=0;n<t;n++)e.push(et());return e},M=function(t,e){e.forEach(function(e){e.id===t.id&&(e.chief_age=v(12,45))})},j=function(t,e){if(N(t,e),function(t,e){var n=Math.random()<=t.chief_age/1e3-.3;return n&&V("DEATH","".concat(t.name,"'s Chief has died."),[t.id],e),n}(t,e))!function(t,e){var n=K(t,e),i=v(0,n.length);V("DISMANTLE","".concat(i," communities have decided to leave ").concat(t.name,"."),[t.id],e),n.map(function(t,n){n<=i-1&&C(t,e)})}(t,e),M(t,e);else if(null===t.chief){V("DECISION","The chief polity ".concat(t.name," deliberates"),[t.id],e);var n=A(t,e);n&&R(t,n,e)?G(t,n,null,e):D(t,e)}else{var i=Q(t,e);V("DECISION","".concat(i.name,"'s subordinate polity ").concat(t.name," deliberates"),[t.id],e),T(i,t,e)?B(i,t,e):D(t,e)}return t},A=function(t,e){var n=L(t,e).filter(function(t){return!nt(t)}).map(function(t){return Q(t,e)}).sort(function(t,n){return $(t,e)-$(n,e)});return n.length>0&&n[0]},I=function(t,e,n){return[t].concat(Object(c.a)(q(t,n))).reduce(function(t,n){return t+(i=e,r=n,O>=Math.hypot(r.coordinates.x-i.coordinates.x,r.coordinates.y-i.coordinates.y));var i,r},0)},L=function(t,e){return e.filter(function(n){return Q(n,e).id!==t.id&&n.id!==t.id&&I(t,n,e)})},W=function(t,e){var n=[],i=q(t,e).sort(function(t,n){return $(n,e)-$(t,e)});i.length>4&&i.map(function(e,r){r>=4?n.push({chief:i[r-4],target:e}):n.push({chief:t,target:e})}),n.map(function(t){e.forEach(function(e){e.id===t.target.id&&(e.chief=t.chief.id)})})},C=function(t,e){var n=Q(t,e);e.forEach(function(i){i.id===t.id?(V("SECESSION","".concat(i.name," is seceded from ").concat(n.name,"."),[i.id,n.id],e),i.chief=null):i.id===n.id&&(i.has_incurred_secession=!0)})},N=function(t,e){e.forEach(function(e){e.id===t.id&&(e.has_incurred_secession=!1,e.has_incurred_war=!1,e.chief_age+=1)})},R=function(t,e,n){var i=P(t,e,n),r=H(i);return Math.random()<=z(t,i,r)},T=function(t,e,n){var i=1-P(t,e,n);return Math.random()<=i},B=function(t,e,n){V("REBELLION","".concat(e.name," attempts rebellion against ").concat(t.name,"."),[e.id],n);var i=P(t,e,n);F(1-i)?(V("REBELLION","".concat(e.name," succeeds in rebellion against ").concat(t.name,"."),[e.id],n),J(U(i),[t.id,e.id],n),C(e,n),W(Q(t),n)):(V("REBELLION","".concat(e.name," fails in rebellion against ").concat(t.name,"."),[e.id],n),J(H(i),[t.id,e.id],n))},D=function(t,e){V("PEACE","".concat(t.name," has peace."),[t.id],e),X(Math.sign(t.baseline_resource_level-t.resource_level)*(t.baseline_resource_level/3),[t.id],e)},G=function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0,a=function(t,e,n){var i=[];return(i=q(e,n).length>0?L(t,n).filter(function(t){return Q(t,n).id===e.id}).sort(function(t,e){return $(e,n)-$(t,n)}):L(t,n).filter(function(t){return t.id===e.id})).length>0&&i[0]}(e,n,r);if(a){V("WAR","".concat(e.name," prepares for war against ").concat(n.name),[e.id],r);var o=P(e,a,r);null===i&&(i=1-o),!F(i)?(V("WAR","".concat(e.name," succeeds in battle against ").concat(a.name),[e.id],r),J(H(o),[e.id,a.id],r),function(t,e,n){var i=K(e,n).map(function(t){return t.id});n.forEach(function(n){n.id===e.id&&(n.chief=t.id),i.indexOf(n.id)>-1&&(n.chief=null)})}(e,a,r),W(e,r),i-=.8*i,Q(n,r).id!==e.id&&(V("WAR","".concat(e.name,"'s onslaught continues against ").concat(n.name),[e.id],r),t(e,n,i,r))):(V("WAR","".concat(e.name," fails in battle against ").concat(a.name),[e.id],r),J(U(o),[e.id,a.id],r))}else V("IMPASSE","".concat(n.name," has no communities with reach of ").concat(e.name,"'s assualt."),[e.id],r)},F=function(t){return Math.random()<=t},P=function(t,e,n){var i=Math.pow($(t,n),2);return i/(i+Math.pow($(e,n),2))},z=function(t,e,n){return e*Math.exp(-2*n)*(t.resource_level/t.baseline_resource_level)},H=function(t){return w*(1-t)},U=function(t){return w*t},J=function(t,e,n){n.forEach(function(n){e.indexOf(n.id)>-1&&(n.resource_level=Math.max(0,n.resource_level-t))})},X=function(t,e,n){n.forEach(function(n){e.indexOf(n.id)>-1&&(n.resource_level+=t)})},$=function(t,e){return K(t,e).reduce(function(t,e){return t+.5*e.resource_level},0)+t.resource_level},q=function(t,e){return e.filter(function(n){return n.id!==t.id&&Q(n,e).id===t.id})},K=function(t,e){return e.filter(function(e){return e.id!==t.id&&e.chief===t.id})},Q=function t(e,n){var i=!1,r=[];return null!==e.chief&&(r=n.filter(function(t){return t.id===e.chief})),r.length>0&&(i=r[0]),i?t(i,n):e},V=function(t,e,n,i){i.forEach(function(i){n.indexOf(i.id)>-1&&(i.events=i.events.concat(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"DEFAULT",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return{event:Y[t],message:e}}(t,e)))})},Y={DEFAULT:{color:"gray"},DECISION:{color:"green"},WAR:{color:"red"},PEACE:{color:"blue"},SECESSION:{color:"yellow"},ANNEX:{color:"orange"},DEATH:{color:"purple"},DISMANTLE:{color:"gray"},IMPASSE:{color:"gray"}},Z=function(t){var e=t.length;return t.map(function(n){return{percent:q(n,t).length/e,polity_id:n.id}})},tt=function(t){return t.map(function(t){return{events:Object(c.a)(t.events),polity_id:t.id}})};function et(){var t=1+v(-1,1)*w;return{id:g()(),name:at([it,rt]),baseline_resource_level:t,resource_level:t,chief:null,coordinates:{x:v(0,b),y:v(0,b)},has_incurred_secession:!1,has_incurred_war:!1,chief_age:30,events:[],color:x.a.Util.getRandomColor()}}var nt=function(t){return t.has_incurred_secession&&t.has_incurred_war},it=["Moon","Sun","Black","White","Light","Shadow","Red","Green","Gray","Mighty","Wither","Gale","Hay","Stone","River"],rt=["Fire","Water","Belly","Peaks","Born","Still","Wood","Wine","Run","Guard","Fell","Fall"],at=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(t){return(e=t).length>0?e[v(0,e.length-1)]:null;var e}).join(" ")},ot=n(5),ct=(r.a.Component,function(t){function e(){var t,n;Object(f.a)(this,e);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(d.a)(this,(t=Object(p.a)(e)).call.apply(t,[this].concat(r)))).state={step_distance:100,entity_distance:40,offset_x:160,offset_y:25,previous_polity_power:0,padding_right:20,event_text_width:60},n}return Object(m.a)(e,t),Object(h.a)(e,[{key:"render",value:function(){var t=this,e=this.props.all_historical_polities.map(function(t){return{polity:t,points:[]}});this.props.history.map(function(n,i){n.polities.map(function(r,a){var o=a>0?n.percents.slice(0,a).reduce(function(t,e){return t+e.percent},0):0,s=n.percents.filter(function(t){return t.polity_id===r.id})[0].percent,u=(t.props.width-t.state.offset_x)*(s+o),l=i*t.state.step_distance;e=e.map(function(t){return t.polity.id===r.id&&(t.points=[].concat(Object(c.a)(t.points),[u,l])),t})})});var n=this.state.offset_x,i=this.state.offset_y,a=this.props.history.length*this.state.step_distance;return a>=this.props.height-this.state.offset_y&&(i=this.state.offset_y-a+(this.props.height-this.state.step_distance)),r.a.createElement(ot.Group,null,r.a.createElement(ot.Group,{draggable:!0,dragBoundFunc:function(t){return{x:0,y:Math.min(0,t.y)}}},this.props.polities.map(function(e,n){return r.a.createElement(ot.Group,null,r.a.createElement(ot.Text,{x:20,y:100+50*n,text:e.name,fill:e.color,fontSize:20}),r.a.createElement(ot.Text,{x:20,y:120+50*n,text:Math.round(100*$(e,t.props.polities))/100,fill:e.color,fontSize:20}))})),r.a.createElement(ot.Group,{x:n,y:i,draggable:!0,dragBoundFunc:function(e){return{x:t.state.offset_x,y:Math.min(t.state.offset_y,e.y)}}},e.map(function(e,n){var i=[];return t.props.history.forEach(function(e,n){n===t.props.history.length-1&&(i=(i=i.concat([0,n*t.state.step_distance])).concat([0,0]))}),r.a.createElement(ot.Line,{key:n,x:0,y:0,points:e.points.concat(i),stroke:e.polity.color,tension:0,strokeWidth:4,closed:!0,fill:e.polity.color})}).reverse(),this.props.history.map(function(e,n){return r.a.createElement(ot.Line,{key:n,x:-5,y:0,points:[0,n*t.state.step_distance,t.props.width+t.state.offset_x,n*t.state.step_distance],stroke:"black",tension:0,strokeWidth:2})}),this.props.history.map(function(e,n){return e.polities.map(function(i,a){var o=a>0?e.percents.slice(0,a).reduce(function(t,e){return t+e.percent},0):0,c=e.percents.filter(function(t){return t.polity_id===i.id})[0].percent,s=(t.props.width-t.state.offset_x)*(c+o),u=(t.props.width-t.state.offset_x)*o,l=e.events.filter(function(t){return t.polity_id===i.id}),f=l.length>0?l[0].events:[];if(c>0)return r.a.createElement(ot.Text,{key:a,x:u+(s-u-t.state.event_text_width/2)/2,y:n*t.state.step_distance,width:t.state.event_text_width,text:f.length>0?f[f.length-1].message:"none",fill:"white",fontSize:10})})})))}}]),e}(r.a.Component)),st=function(t){function e(){var t;Object(f.a)(this,e),t=Object(d.a)(this,Object(p.a)(e).call(this));var n=S(20),i=Z(n);return t.state={polities:n,all_historical_polities:n,width:window.innerWidth-40,height:window.innerHeight,history:[{polities:n,percents:i,events:[]}]},t}return Object(m.a)(e,t),Object(h.a)(e,[{key:"componentDidMount",value:function(){var t=Object(l.a)(u.a.mark(function t(){var e;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:console.table(this.state.polities),e=0;case 2:if(!(e<50)){t.next=8;break}return t.next=5,this.step(500);case 5:e++,t.next=2;break;case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"step",value:function(){var t=Object(l.a)(u.a.mark(function t(){var e,n,i,r,a,o=arguments;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=o.length>0&&void 0!==o[0]?o[0]:0,t.next=3,k(Object(c.a)(this.state.polities),1,e);case 3:n=t.sent,i=Z(n),r=tt(n),a=this.state.history.concat({polities:n,percents:i,events:r}),this.setState({polities:n,history:a});case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this;return r.a.createElement(ot.Stage,{width:this.state.width,height:this.state.height},r.a.createElement(ot.Layer,null,r.a.createElement(ot.Rect,{x:20,y:20,width:100,height:50,fill:"red",onClick:function(){return t.step()}}),r.a.createElement(ot.Text,{x:50,y:40,text:"Step",fill:"black",fontSize:20})),r.a.createElement(ot.Layer,null,r.a.createElement(ct,{polities:this.state.polities,all_historical_polities:this.state.all_historical_polities,history:this.state.history,width:this.state.width,height:this.state.height})))}}]),e}(r.a.Component);var ut=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(st,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(ut,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[41,1,2]]]);
//# sourceMappingURL=main.f09300d3.chunk.js.map